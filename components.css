/* ══════════════════════════════════════════════════
   NUTRIPLAN — components.css
   Sezioni: 17. Piano Pasto  18. Frigo  19. Ricette
            20. RC-Card  21. Modal  22. Storico
            23. Spesa  24. Statistiche  25. Profilo
            26. Auth
══════════════════════════════════════════════════ */

/* ══════════════════════════════════════════════════
   17. PIANO PASTO
══════════════════════════════════════════════════ */
.meal-progress-wrap { margin-bottom: 16px; }
.meal-prog-bar-wrap { display: flex; align-items: center; gap: 10px; }
.meal-prog-bar {
  flex: 1; height: 5px;
  background: var(--border); border-radius: var(--r-full); overflow: hidden;
}
.meal-prog-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-mid));
  border-radius: var(--r-full); transition: width .5s;
}
.meal-prog-label { font-size: .7rem; font-weight: 700; color: var(--text-mid); white-space: nowrap; }

/* Selettore pasto (colazione/pranzo/cena…) */
.meal-selector,
#mealSelector {
  display: flex; gap: 8px;
  overflow-x: auto; scrollbar-width: none;
  padding: 2px 0 14px; flex-wrap: nowrap;
  -webkit-overflow-scrolling: touch;
}
.meal-selector::-webkit-scrollbar,
#mealSelector::-webkit-scrollbar { display: none; }

.meal-btn {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 6px;
  padding: 10px 14px; min-width: 72px; flex-shrink: 0;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); cursor: pointer; transition: all var(--t);
}
.meal-btn:hover {
  border-color: var(--primary-mid);
  background: var(--primary-xl);
  transform: translateY(-1px);
}
.meal-btn.active {
  background: var(--primary); border-color: var(--primary-dark);
  box-shadow: 0 4px 14px rgba(61,139,111,.3);
  transform: translateY(-1px);
}
.meal-btn-icon  { font-size: 1.35rem; flex-shrink: 0; }
.meal-btn-label {
  font-size: .78rem; font-weight: 800;
  color: var(--text-mid); letter-spacing: .02em;
  line-height: 1.2; text-align: center;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: 100%;
}
.meal-btn.active .meal-btn-label { color: rgba(255,255,255,.9); }
.meal-btn-count {
  font-size: .6rem; font-weight: 800;
  background: var(--primary-light); color: var(--primary);
  padding: 2px 8px; border-radius: var(--r-full);
}
.meal-btn.active .meal-btn-count { background: rgba(255,255,255,.22); color: #fff; }

/* Lista item pasto */
.meal-items-list       { display: flex; flex-direction: column; gap: 7px; }
.meal-category-title   {
  font-size: .66rem; font-weight: 800; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .09em; padding: 12px 0 5px;
}
.meal-item {
  display: flex; align-items: center; gap: 12px;
  background: var(--bg-card); border-radius: var(--r-lg);
  border: 1.5px solid var(--border); padding: 12px 14px;
  transition: all var(--t);
}
.meal-item:hover { border-color: var(--primary-mid); box-shadow: var(--shadow-xs); }
.meal-item.used  { opacity: .45; }

.meal-item-icon    { font-size: 1.2rem; flex-shrink: 0; }
.meal-item-info    { flex: 1; min-width: 0; }
.meal-item-name    { font-size: .86rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.meal-item-qty     { font-size: .7rem; color: var(--text-light); margin-top: 2px; }
.meal-item-status  { font-size: .7rem; font-weight: 700; }
.meal-item-status.avail   { color: var(--success); }
.meal-item-status.missing { color: var(--danger);  }
.meal-item-actions { display: flex; gap: 5px; flex-shrink: 0; }

/* Pagina Oggi — card ingrediente compatta (solo nome, + dispensa / + spesa) */
.piano-item-card .piano-item-row {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 12px; flex-wrap: wrap;
}
.piano-item-card .piano-item-name {
  flex: 1; min-width: 0;
  font-weight: 600; font-size: .9em;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.piano-item-card .piano-item-qty { font-size: .72em; }
.piano-item-card .piano-item-sub { font-size: .7em; }
.piano-item-card .piano-item-actions {
  display: flex; align-items: center; gap: 6px; flex-shrink: 0;
}
.piano-item-add-btns {
  display: flex; flex-direction: column; gap: 4px;
}
.piano-item-add-btns .rc-btn { white-space: nowrap; }
@media (min-width: 420px) {
  .piano-item-add-btns { flex-direction: row; }
}

.meal-item-btn {
  width: 30px; height: 30px;
  background: var(--bg-subtle); border: 1.5px solid var(--border);
  border-radius: var(--r-sm); cursor: pointer; font-size: .88rem;
  display: flex; align-items: center; justify-content: center;
  color: var(--text-mid); transition: all var(--t);
}
.meal-item-btn:hover   { background: var(--primary); color: #fff; border-color: var(--primary); }
.btn-use-item:hover    { background: var(--success) !important; border-color: var(--success) !important; }
.btn-del-item:hover    { background: var(--danger)  !important; border-color: var(--danger)  !important; }

/* Row aggiungi item */
.add-item-row {
  display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
  background: var(--primary-xl);
  border: 1.5px dashed var(--primary-mid);
  border-radius: var(--r-lg); padding: 12px 14px; margin-top: 10px;
}
.add-item-row input,
.add-item-row select { flex: 1; min-width: 100px; }

/* Pasti completati */
.meals-done-bar {
  display: flex; align-items: center; gap: 12px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 14px 16px; margin-bottom: 16px;
}
.meals-done-icon   { font-size: 1.4rem; flex-shrink: 0; }
.meals-done-info   { flex: 1; min-width: 0; }
.meals-done-label  {
  font-size: .72rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .07em; margin-bottom: 5px;
}
.meals-done-dots   { display: flex; gap: 6px; }
.meals-done-dot {
  width: 10px; height: 10px; border-radius: 50%;
  background: var(--border-mid); transition: background var(--t);
}
.meals-done-dot.done { background: var(--primary); box-shadow: 0 0 6px rgba(61,139,111,.4); }
.meals-done-count {
  font-size: .84rem; font-weight: 800;
  color: var(--primary); white-space: nowrap; flex-shrink: 0;
}

/* ══════════════════════════════════════════════════
   18. FRIGO
══════════════════════════════════════════════════ */
.fi-group {
  margin-bottom: 10px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); overflow: hidden;
}
.fi-group-header {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  background: color-mix(in srgb, var(--gc, var(--primary)) 6%, var(--bg-card));
}
.fi-group-icon  { font-size: 1.3rem; flex-shrink: 0; }
.fi-group-name  {
  flex: 1; font-size: .76rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: .07em;
  color: var(--gc, var(--primary));
}
.fi-group-count {
  background: color-mix(in srgb, var(--gc, var(--primary)) 14%, transparent);
  color: var(--gc, var(--primary));
  font-size: .66rem; font-weight: 800;
  border-radius: var(--r-full); padding: 2px 10px;
  border: 1px solid color-mix(in srgb, var(--gc, var(--primary)) 30%, transparent);
}

/* Categorie collassabili (Spesa, Dispensa, Oggi) */
.fi-group-collapsible {
  display: block;
}
.fi-group-collapsible .fi-group-header {
  list-style: none;
  cursor: pointer;
  user-select: none;
}
.fi-group-collapsible .fi-group-header::-webkit-details-marker { display: none; }
.fi-group-collapsible .fi-group-header::before {
  content: '▶';
  font-size: .6em;
  opacity: .8;
  margin-right: 4px;
  transition: transform .2s ease;
  display: inline-block;
}
.fi-group-collapsible[open] .fi-group-header::before {
  transform: rotate(90deg);
}
.fi-group-collapsible > .fi-list {
  border-top: 1px solid var(--border);
}

.fi-list { display: flex; flex-direction: column; }
.fi-row {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: background var(--t); position: relative;
}
.fi-row:last-child { border-bottom: none; }
.fi-row:hover      { background: var(--bg-hover); }
.fi-row:active     { background: var(--bg-subtle); }

.fi-row-icon {
  font-size: 1.5rem; flex-shrink: 0;
  width: 40px; height: 40px;
  display: flex; align-items: center; justify-content: center;
  background: color-mix(in srgb, var(--rc, var(--primary)) 10%, transparent);
  border-radius: var(--r-lg);
}
.fi-row-info  { flex: 1; min-width: 0; }
.fi-row-name  { font-size: .88rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fi-row-unit  { font-size: .7rem; color: var(--text-light); font-weight: 600; margin-top: 2px; }
.fi-row-right { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }

.fi-btn {
  width: 30px; height: 30px;
  background: var(--bg-subtle); border: 1.5px solid var(--border);
  border-radius: var(--r-sm); font-size: 1.05rem; font-weight: 800;
  line-height: 1; cursor: pointer; transition: all var(--t);
  display: flex; align-items: center; justify-content: center;
  color: var(--text-mid); flex-shrink: 0;
}
.fi-btn:hover  { transform: scale(1.12); }
.fi-btn:active { transform: scale(.9); }
.fi-btn-minus:hover { background: #fee2e2; color: var(--danger); border-color: #fecaca; }
.fi-btn-plus:hover  { background: var(--primary-light); color: var(--primary); border-color: var(--primary-mid); }

.fi-qty {
  min-width: 40px; text-align: center;
  font-size: .9rem; font-weight: 800; color: var(--text);
  transition: transform .15s ease;
}
.fi-qty-flash { animation: qtyFlash .4s ease; }
@keyframes qtyFlash {
  0%   { transform: scale(1); }
  35%  { transform: scale(1.25); color: var(--primary); }
  100% { transform: scale(1); }
}

.fi-row-del {
  width: 26px; height: 26px; flex-shrink: 0;
  background: none; border: none; cursor: pointer;
  font-size: .72rem; color: var(--text-light);
  border-radius: var(--r-xs);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all var(--t);
}
.fi-row:hover .fi-row-del { opacity: 1; }
.fi-row-del:hover          { color: var(--danger); background: #fee2e2; }

/* Frigo salvato */
.saved-fridge-item {
  display: flex; align-items: center; gap: 12px;
  background: var(--bg-card); border-radius: var(--r-lg);
  border: 1.5px solid var(--border); padding: 14px 16px;
  margin-bottom: 8px; transition: all var(--t);
}
.saved-fridge-item:hover  { border-color: var(--primary-mid); box-shadow: var(--shadow-xs); }
.saved-fridge-info        { flex: 1; min-width: 0; }
.saved-fridge-name        { font-size: .88rem; font-weight: 800; }
.saved-fridge-date        { font-size: .7rem; color: var(--text-light); margin-top: 2px; }
.saved-fridge-actions     { display: flex; gap: 6px; flex-shrink: 0; }

/* ══════════════════════════════════════════════════
   19. RICETTE
══════════════════════════════════════════════════ */

/* Filtri: due righe (Pasto + Compatibilità) su mobile e desktop */
.ricette-filter-row,
#ricetteFilterRow {
  display: flex;
  flex-direction: column;
  gap: 0;
  padding: 2px 0 14px;
  width: 100%;
  position: static;
}
#ricetteFilterRow > div {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 6px;
  width: 100%;
}
#ricetteFilterRow > div:last-child { margin-bottom: 0; }
.ricette-filter-row::-webkit-scrollbar,
#ricetteFilterRow::-webkit-scrollbar { display: none; }

.rf-pill {
  display: inline-flex; align-items: center; justify-content: center;
  gap: 6px;
  padding: 8px 14px; border: 1.5px solid var(--border);
  border-radius: var(--r-full);
  background: var(--bg-card); color: var(--text-mid);
  font-size: .78rem; font-weight: 700;
  line-height: 1.2;
  cursor: pointer; white-space: nowrap; flex-shrink: 0;
  transition: all var(--t);
}
.rf-pill:hover  {
  background: var(--primary-light); color: var(--primary);
  border-color: var(--primary-mid); transform: translateY(-1px);
}
.rf-pill.active {
  background: var(--primary); color: #fff;
  border-color: var(--primary-dark);
  box-shadow: 0 3px 12px rgba(61,139,111,.28);
}

/* Gruppo ricette */
.rc-group {
  position: static;     /* FIX: mai absolute */
  width: 100%;
  margin-bottom: 32px;
}
.rc-group-title {
  display: flex; align-items: center; gap: 10px;
  font-size: .67rem; font-weight: 800;
  color: var(--gc, var(--primary));
  text-transform: uppercase; letter-spacing: .09em;
  margin-bottom: 12px; padding-bottom: 10px;
  border-bottom: 1.5px solid
    color-mix(in srgb, var(--gc, var(--primary)) 22%, transparent);
}
.rc-group-count {
  margin-left: auto;
  background: var(--bg-subtle); color: var(--text-light);
  font-size: .82em; border-radius: var(--r-full);
  padding: 1px 10px; font-weight: 800;
  border: 1.5px solid var(--border);
}

/* FIX griglia ricette — mai position absolute/fixed */
.rc-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
  gap: 10px;
  width: 100%;
  position: static;   /* ← FIX "spostate a sinistra" */
  margin: 0;
  left: auto;
}
@media (min-width: 768px)  { .rc-grid { grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); } }
@media (min-width: 1024px) { .rc-grid { grid-template-columns: repeat(3,1fr); } }

/* Empty state ricette */
.rc-empty {
  display: flex; flex-direction: column;
  align-items: center; padding: 48px 24px;
  text-align: center; gap: 12px;
}
.rc-empty-icon  { font-size: 2.8rem; opacity: .45; }
.rc-empty-title { font-size: .92rem; font-weight: 800; color: var(--text-mid); }
.rc-empty-text  { font-size: .78rem; color: var(--text-light); max-width: 240px; line-height: 1.5; }

/* Ingredienti nella modale nuova ricetta */
.ing-add-row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
.ing-add-row input,
.ing-add-row select    { flex: 1; }
.ing-added-list        { display: flex; flex-direction: column; gap: 4px; margin-top: 10px; }
.ing-added-item {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 10px; background: var(--bg-subtle);
  border-radius: var(--r-sm); font-size: .82rem;
}
.ing-added-item span   { flex: 1; min-width: 0; font-weight: 600; }
.ing-added-item .remove-ing {
  background: none; border: none; cursor: pointer;
  font-size: .8rem; color: var(--text-light);
  padding: 2px 4px; border-radius: var(--r-xs);
  transition: all var(--t);
}
.ing-added-item .remove-ing:hover { color: var(--danger); background: #fee2e2; }

/* ══════════════════════════════════════════════════
   20. RC-CARD ACCORDION
══════════════════════════════════════════════════ */
.rc-card {
  position: relative;         /* stacking context locale */
  contain: layout style;      /* impedisce al layout di uscire */
  background: var(--bg-card);
  border-radius: var(--r-xl);
  border: 1.5px solid var(--border);
  overflow: hidden;
  cursor: pointer;
  transition: border-color var(--t), box-shadow var(--t), transform var(--t);
}
.rc-card:hover {
  border-color: var(--cc, var(--primary));
  box-shadow: var(--shadow-sm);
  transform: translateY(-2px);
}
.rc-card.open  {
  border-color: var(--cc, var(--primary));
  box-shadow: var(--shadow);
  transform: none;
}

.rc-card-head {
  display: flex; align-items: center;
  gap: 12px; padding: 14px;
}
.rc-icon-wrap {
  width: 46px; height: 46px; flex-shrink: 0;
  background: color-mix(in srgb, var(--cc, var(--primary)) 10%, transparent);
  border-radius: var(--r-lg);
  display: flex; align-items: center;
  justify-content: center; font-size: 1.5rem;
}
.rc-custom .rc-icon-wrap { background: #fffbeb; }

.rc-info { flex: 1; min-width: 0; }
.rc-name {
  font-size: .88rem; font-weight: 800; line-height: 1.3;
  color: var(--text); margin-bottom: 5px;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
}
.rc-meta  { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
.rc-pasto { font-size: .68rem; font-weight: 700; }

.rc-badge {
  display: inline-flex; align-items: center;
  font-size: .64rem; font-weight: 800;
  padding: 2px 9px; border-radius: var(--r-full);
  border: 1px solid var(--border);
  background: var(--bg-subtle); color: var(--text-light);
}
.badge-ok   { background: #dcfce7; color: #166534; border-color: #bbf7d0; }
.badge-warn { background: #fef3c7; color: #92400e; border-color: #fde68a; }
.badge-grey { background: var(--bg-subtle); color: var(--text-light); border-color: var(--border); }
[data-theme="dark"] .badge-ok   { background: #052e16; color: #4ade80; border-color: #14532d; }
[data-theme="dark"] .badge-warn { background: #2d1b00; color: #fcd34d; border-color: #78350f; }

.rc-chevron {
  width: 28px; height: 28px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  color: var(--text-light); font-size: 1rem;
  transition: transform var(--t);
}
.rc-card.open .rc-chevron { transform: rotate(180deg); }

.rc-card-body {
  display: none;
  padding: 0 14px 14px;
  position: relative;       /* stacking locale */
}
.rc-card.open .rc-card-body { display: block; }

/* ── rc-accordion: collapse/expand per ricette cards ── */
.rc-accordion {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease, opacity 0.2s ease;
  opacity: 0;
}
.rc-card.open .rc-accordion {
  max-height: 2000px;
  opacity: 1;
}
.rc-accordion-inner {
  padding: 0 14px 14px;
  border-top: 1px solid var(--border);
}

/* Lista ingredienti nell'accordion */
.rc-acc-list {
  list-style: none; padding: 0;
  margin: 10px 0 6px;
  display: flex; flex-direction: column; gap: 4px;
}
.rc-acc-item {
  display: flex; align-items: center; gap: 8px;
  padding: 5px 8px; border-radius: var(--r-sm);
  background: var(--bg-subtle); font-size: .8rem;
}
.rc-acc-item.ok {
  background: color-mix(in srgb, #22c55e 8%, var(--bg-subtle));
}
.rc-acc-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: var(--border-mid); flex-shrink: 0;
}
.rc-acc-item.ok .rc-acc-dot { background: var(--success); }
.rc-acc-name { flex: 1; font-weight: 600; }
.rc-acc-qty  { font-size: .72rem; color: var(--text-light); font-weight: 700; }

/* Bottone dettaglio / azione dentro accordion */
.rc-detail-btn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 7px 12px;
  background: var(--primary-xl);
  border: 1.5px solid var(--primary-mid);
  border-radius: var(--r-lg);
  color: var(--primary); font-weight: 700; font-size: .8rem;
  cursor: pointer; transition: all var(--t); white-space: nowrap;
}
.rc-detail-btn:hover { background: var(--primary); color: #fff; border-color: var(--primary); }
.rc-detail-btn.btn-choose {
  background: var(--primary); color: #fff; border-color: var(--primary-dark);
}
.rc-detail-btn.btn-choose:hover { background: var(--primary-dark); }

/* Etichette sezione nella tab Piano */
.piano-section-label {
  font-size: .72rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: .06em;
  color: var(--text-light);
  padding: 14px 0 10px;
  border-top: 1px solid var(--border);
  margin-top: 8px;
  line-height: 1.3;
  display: block;
}
.piano-section-label:first-child { border-top: none; margin-top: 0; padding-top: 0; }

.rc-ing-list   { display: flex; flex-direction: column; gap: 4px; margin: 10px 0; }
.rc-ing-row    {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 10px; border-radius: var(--r-sm);
  background: var(--bg-subtle); font-size: .8rem;
}
.rc-ing-icon   { font-size: 1rem; flex-shrink: 0; }
.rc-ing-name   { flex: 1; min-width: 0; font-weight: 600; }
.rc-ing-qty    { font-size: .74rem; color: var(--text-light); font-weight: 700; white-space: nowrap; }
.rc-ing-status        { font-size: .72rem; font-weight: 700; white-space: nowrap; }
.rc-ing-status.ok     { color: var(--success); }
.rc-ing-status.ko     { color: var(--danger); }

.rc-macros-row { display: flex; gap: 6px; flex-wrap: wrap; margin: 10px 0 4px; }
.rc-macro-chip {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: .7rem; font-weight: 700; padding: 4px 10px;
  border-radius: var(--r-full); background: var(--bg-subtle);
  border: 1px solid var(--border); color: var(--text-mid);
}

/* ══════════════════════════════════════════════════
   21. MODAL
══════════════════════════════════════════════════ */
/* Usa .modal.active (non .modal-overlay.open) */
.modal {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(0,0,0,.48);
  display: none;
  align-items: flex-end; justify-content: center;
  padding: 0; overflow: hidden;
  -webkit-tap-highlight-color: transparent;
}
.modal.active {
  display: flex;
  animation: modalBgIn var(--t-slow) ease;
}
@keyframes modalBgIn {
  from { background: rgba(0,0,0,0); }
  to   { background: rgba(0,0,0,.48); }
}

@media (min-width: 600px) {
  .modal { align-items: center; padding: 24px; }
}

.modal-box {
  background: var(--bg-card);
  border-radius: var(--r-2xl) var(--r-2xl) 0 0;
  width: 100%; max-width: 540px;
  max-height: 92dvh;
  display: flex; flex-direction: column;
  padding: 20px 20px calc(20px + env(safe-area-inset-bottom));
  box-shadow: var(--shadow-lg);
  animation: sheetIn var(--t-slow) ease;
}
@media (min-width: 600px) {
  .modal-box {
    border-radius: var(--r-2xl); padding: 28px;
    animation: scaleIn var(--t-slow) ease;
  }
}
@keyframes sheetIn { from { transform: translateY(40px); opacity: .3; } to { transform: none; opacity: 1; } }
@keyframes scaleIn { from { transform: scale(.94);       opacity: .3; } to { transform: scale(1); opacity: 1; } }

.modal-handle {
  width: 40px; height: 4px; border-radius: var(--r-full);
  background: var(--border-mid); margin: 0 auto 20px; flex-shrink: 0;
}
@media (min-width: 600px) { .modal-handle { display: none; } }

.modal-header {
  display: flex; align-items: flex-start;
  justify-content: space-between; gap: 12px; margin-bottom: 20px;
  flex-shrink: 0;
}
.modal-title { font-size: 1.05rem; font-weight: 800; line-height: 1.3; }
.modal-close {
  width: 36px; height: 36px; flex-shrink: 0;
  background: var(--bg-subtle); border: 1px solid var(--border);
  border-radius: var(--r-full); cursor: pointer;
  font-size: 1.1rem; font-weight: 700;
  color: var(--text-1);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
}
[data-theme="light"] .modal-close {
  color: #374151; background: #f3f4f6; border-color: #d1d5db;
}
.modal-close:hover { background: #fee2e2; color: var(--danger); border-color: #fecaca; }
[data-theme="dark"] .modal-close:hover { background: rgba(220,38,38,.2); border-color: var(--danger); }
.modal-body   { flex: 1; min-height: 0; overflow-y: auto; margin-bottom: 0; padding-bottom: 8px; }
.modal-footer { display: flex; gap: 10px; margin-top: 16px; justify-content: flex-end; flex-shrink: 0; }
.modal-footer-rc { flex-wrap: wrap; gap: 8px; }
.modal-box-rc .modal-footer .rc-btn { flex-shrink: 0; }

/* Input quantità grande (es. modale frigo) */
.qty-modal-wrap {
  display: flex; align-items: center;
  gap: 12px; margin: 16px 0;
}
.qty-modal-wrap input[type="number"] {
  flex: 1; font-size: 1.8rem; font-weight: 800;
  text-align: center; padding: 14px 10px; border-radius: var(--r-lg);
}
.qty-modal-unit { font-size: .9rem; font-weight: 700; color: var(--text-light); white-space: nowrap; }

/* Barcode result modal */
.barcode-result-header {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 18px; padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}
.barcode-result-icon  { font-size: 2.4rem; flex-shrink: 0; }
.barcode-result-name  { font-size: 1rem; font-weight: 800; margin-bottom: 4px; }
.barcode-result-cat   { font-size: .78rem; color: var(--text-3); }

/* Sezione dettagli collassabili */
.barcode-details {
  margin-top: 16px;
  border: 1px solid var(--border);
  border-radius: var(--r-lg);
  overflow: hidden;
}
.barcode-details summary {
  cursor: pointer; padding: 10px 14px;
  font-size: .82rem; font-weight: 700; color: var(--text-2);
  background: var(--bg-subtle);
  user-select: none; list-style: none;
  display: flex; align-items: center; gap: 6px;
  transition: background var(--t);
}
.barcode-details summary::-webkit-details-marker { display: none; }
.barcode-details summary:hover { background: var(--bg-card); }
.barcode-details[open] summary { border-bottom: 1px solid var(--border); }

.barcode-details-body { padding: 12px 14px; }
.barcode-brand {
  font-size: .85rem; margin-bottom: 12px;
  padding-bottom: 10px; border-bottom: 1px solid var(--border);
}
.barcode-macro-label {
  font-size: .7rem; font-weight: 800; text-transform: uppercase;
  letter-spacing: .07em; color: var(--text-3); margin-bottom: 8px;
}
.barcode-macro-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 6px;
}
.barcode-macro-chip {
  display: flex; flex-direction: column; gap: 2px;
  padding: 8px 10px; border-radius: var(--r-md);
  background: var(--bg-subtle); border: 1px solid var(--border);
  font-size: .78rem;
}
.barcode-macro-chip span { color: var(--text-3); font-size: .7rem; }
.barcode-macro-chip strong { font-weight: 800; color: var(--text); }

/* ══════════════════════════════════════════════════
   22. STORICO
══════════════════════════════════════════════════ */
.storico-card {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 16px; margin-bottom: 10px;
  transition: all var(--t);
}
.storico-card:hover { border-color: var(--primary-mid); box-shadow: var(--shadow-xs); }

.storico-card-header {
  display: flex; align-items: center;
  justify-content: space-between; gap: 12px; margin-bottom: 10px;
}
.storico-date  { font-size: .78rem; font-weight: 800; color: var(--text-mid); }
.storico-score {
  font-size: .7rem; font-weight: 800; padding: 3px 10px;
  border-radius: var(--r-full);
  background: var(--primary-light); color: var(--primary);
  border: 1px solid var(--primary-mid);
}

.storico-macros { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 6px; }
.storico-macro  {
  display: flex; flex-direction: column; align-items: center;
  background: var(--bg-subtle); border-radius: var(--r-sm);
  padding: 6px 12px; min-width: 60px;
}
.storico-macro-val   { font-size: .9rem; font-weight: 800; color: var(--text); }
.storico-macro-label {
  font-size: .6rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .06em;
}

.storico-meal-row {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.storico-meal-row:last-child { border-bottom: none; }
.storico-meal-icon { font-size: 1.1rem; flex-shrink: 0; }
.storico-meal-name { flex: 1; font-size: .84rem; font-weight: 700; }
.storico-meal-kcal { font-size: .78rem; font-weight: 800; color: var(--primary); }

.storico-empty {
  display: flex; flex-direction: column; align-items: center;
  padding: 48px 24px; text-align: center; gap: 10px;
}
.storico-empty-icon  { font-size: 2.4rem; opacity: .4; }
.storico-empty-title { font-size: .88rem; font-weight: 800; color: var(--text-mid); }

/* ══════════════════════════════════════════════════
   23. SPESA
══════════════════════════════════════════════════ */
.spesa-group {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); overflow: hidden; margin-bottom: 12px;
}
.spesa-group-header {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  background: color-mix(in srgb, var(--gc, var(--primary)) 5%, var(--bg-card));
}
.spesa-group-title {
  flex: 1; font-size: .76rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: .07em;
  color: var(--gc, var(--primary));
}
.spesa-group-count { font-size: .7rem; font-weight: 800; color: var(--text-light); }

.spesa-item {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  transition: background var(--t); cursor: pointer;
}
.spesa-item:last-child { border-bottom: none; }
.spesa-item:hover      { background: var(--bg-hover); }
.spesa-item.checked    { opacity: .5; }

.spesa-check {
  width: 20px; height: 20px; flex-shrink: 0;
  border: 2px solid var(--border-mid);
  border-radius: var(--r-xs); background: none;
  cursor: pointer; transition: all var(--t);
  display: flex; align-items: center; justify-content: center;
}
.spesa-item.checked .spesa-check {
  background: var(--primary); border-color: var(--primary); color: #fff;
}
.spesa-item-info { flex: 1; min-width: 0; }
.spesa-item-name { font-size: .86rem; font-weight: 700; }
.spesa-item.checked .spesa-item-name { text-decoration: line-through; color: var(--text-light); }
.spesa-item-qty  { font-size: .72rem; color: var(--text-light); margin-top: 2px; }

/* ══════════════════════════════════════════════════
   24. STATISTICHE
══════════════════════════════════════════════════ */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
  gap: 10px; margin-bottom: 20px;
}
.stat-card {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 16px; text-align: center;
  transition: all var(--t);
}
.stat-card:hover { border-color: var(--primary-mid); box-shadow: var(--shadow-xs); }
.stat-icon  { font-size: 1.6rem; margin-bottom: 8px; }
.stat-val   { font-size: 1.4rem; font-weight: 800; color: var(--text); line-height: 1; }
.stat-label {
  font-size: .66rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .07em; margin-top: 4px;
}
.stat-trend          { font-size: .7rem; font-weight: 700; margin-top: 4px; }
.stat-trend.up       { color: var(--success); }
.stat-trend.down     { color: var(--danger); }
.stat-trend.flat     { color: var(--text-light); }

/* Grafico settimanale a barre */
.stats-week-grid {
  display: grid; grid-template-columns: repeat(7,1fr);
  gap: 4px; margin-bottom: 20px;
}
.stats-day-bar  { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.stats-bar-wrap {
  width: 100%; height: 80px;
  background: var(--bg-subtle);
  border-radius: var(--r-sm) var(--r-sm) 0 0;
  position: relative; overflow: hidden;
  display: flex; align-items: flex-end;
}
.stats-bar-fill {
  width: 100%; min-height: 3px;
  background: linear-gradient(180deg, var(--primary), var(--primary-dark));
  border-radius: var(--r-sm) var(--r-sm) 0 0;
  transition: height .5s ease;
}
.stats-bar-fill.warn { background: linear-gradient(180deg, var(--warning), #d97706); }
.stats-bar-fill.over { background: linear-gradient(180deg, var(--danger),  #b91c1c); }
.stats-day-label {
  font-size: .6rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .06em;
}
.stats-day-val  { font-size: .68rem; font-weight: 800; color: var(--text-mid); }
.stats-day-bar.today .stats-day-label { color: var(--primary); }
.stats-day-bar.today .stats-bar-fill  { box-shadow: 0 0 10px rgba(61,139,111,.45); }

.stats-macro-row  { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
.stats-macro-card {
  flex: 1; min-width: 100px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 14px 12px; text-align: center;
}
.stats-macro-icon  { font-size: 1.4rem; margin-bottom: 6px; }
.stats-macro-val   { font-size: 1.1rem; font-weight: 800; }
.stats-macro-label {
  font-size: .62rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: .07em; color: var(--text-light); margin-top: 3px;
}
.stats-macro-sub   { font-size: .7rem; color: var(--text-light); margin-top: 2px; }

@media (min-width: 768px)  { .stats-bar-wrap { height: 110px; } }
@media (min-width: 1024px) { .stats-macro-row { flex-wrap: nowrap; } }

/* ══════════════════════════════════════════════════
   25. PROFILO
══════════════════════════════════════════════════ */
.profilo-hero {
  display: flex; align-items: center; gap: 16px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 20px; margin-bottom: 20px;
}
.profilo-avatar {
  width: 60px; height: 60px; border-radius: 50%; flex-shrink: 0;
  background: var(--primary-light); border: 2px solid var(--primary-mid);
  display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
}
.profilo-name  { font-size: 1rem; font-weight: 800; }
.profilo-email { font-size: .74rem; color: var(--text-light); margin-top: 2px; }
.profilo-since { font-size: .7rem;  color: var(--text-light); margin-top: 4px; }

.profilo-stats-row { display: flex; gap: 8px; margin-bottom: 20px; }
.profilo-stat {
  flex: 1; background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 14px 12px; text-align: center;
}
.profilo-stat-val   { font-size: 1.2rem; font-weight: 800; color: var(--primary); }
.profilo-stat-label {
  font-size: .66rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .06em; margin-top: 4px;
}

.profilo-tdee-card {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  border-radius: var(--r-xl); padding: 20px; color: #fff; margin-bottom: 16px;
}
[data-theme="dark"] .profilo-tdee-card {
  background: linear-gradient(135deg, #1f5240 0%, #133528 100%);
}
.profilo-tdee-label { font-size: .72rem; font-weight: 700; opacity: .8; text-transform: uppercase; letter-spacing: .08em; }
.profilo-tdee-val   { font-size: 2rem; font-weight: 800; line-height: 1.1; margin: 4px 0; }
.profilo-tdee-sub   { font-size: .78rem; opacity: .75; }

.profilo-macro-targets { display: flex; gap: 8px; margin-top: 14px; }
.profilo-macro-target  {
  flex: 1; background: rgba(255,255,255,.18);
  border-radius: var(--r-lg); padding: 10px 8px; text-align: center;
}
.profilo-macro-target-val   { font-size: .96rem; font-weight: 800; }
.profilo-macro-target-label { font-size: .6rem; font-weight: 700; opacity: .8; margin-top: 2px; }

.settings-section {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); overflow: hidden; margin-bottom: 14px;
}
.settings-section-title {
  font-size: .66rem; font-weight: 800; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .09em; padding: 12px 16px 6px;
}
.settings-row {
  display: flex; align-items: center; gap: 12px;
  padding: 13px 16px; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: background var(--t);
}
.settings-row:last-child { border-bottom: none; }
.settings-row:hover      { background: var(--bg-hover); }
.settings-row-icon  {
  width: 32px; height: 32px; flex-shrink: 0;
  border-radius: var(--r-sm); background: var(--bg-subtle);
  display: flex; align-items: center; justify-content: center; font-size: 1rem;
}
.settings-row-info  { flex: 1; min-width: 0; }
.settings-row-label { font-size: .86rem; font-weight: 700; }
.settings-row-sub   { font-size: .72rem; color: var(--text-light); margin-top: 2px; }
.settings-row-arrow { color: var(--text-light); font-size: .8rem; flex-shrink: 0; }

/* ══════════════════════════════════════════════════
   26. AUTH
══════════════════════════════════════════════════ */
.auth-card {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-2xl); padding: 32px 28px;
  width: 100%; max-width: 400px; margin: 0 auto;
  box-shadow: var(--shadow);
}
.auth-logo {
  width: 64px; height: 64px; border-radius: var(--r-lg);
  background: var(--primary-light); border: 2px solid var(--primary-mid);
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; margin: 0 auto 20px;
}
.auth-title  { font-size: 1.3rem; font-weight: 800; text-align: center; margin-bottom: 6px; }
.auth-sub    { font-size: .82rem; color: var(--text-light); text-align: center; margin-bottom: 24px; }
.auth-divider {
  display: flex; align-items: center; gap: 12px;
  margin: 18px 0; font-size: .7rem; color: var(--text-light); font-weight: 700;
}
.auth-divider::before,
.auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.auth-switch { text-align: center; font-size: .8rem; color: var(--text-light); margin-top: 18px; }
.auth-switch a { font-weight: 700; }

/* ══════════════════════════════════════════════════
   27. RECIPE MODAL  (.rm-*)
══════════════════════════════════════════════════ */
.rm-hero {
  display: flex; align-items: center; gap: 14px;
  padding: 18px 20px 16px;
  border-bottom: 1.5px solid var(--border);
  background: color-mix(in srgb, var(--mc, var(--primary)) 6%, var(--bg-card));
}
.rm-hero-icon {
  width: 52px; height: 52px; flex-shrink: 0;
  border-radius: var(--r-lg);
  background: color-mix(in srgb, var(--mc, var(--primary)) 14%, var(--bg-card));
  border: 2px solid color-mix(in srgb, var(--mc, var(--primary)) 30%, transparent);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.8rem;
}
.rm-hero-name {
  font-size: 1.08rem; font-weight: 800; line-height: 1.2;
  color: var(--text-1);
}
.rm-hero-pasto {
  font-size: .78rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: .06em; margin-top: 3px;
}
.rm-avail {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 20px;
  font-size: .8rem; color: var(--text-2);
  border-bottom: 1px solid var(--border);
}
.rm-avail-track {
  flex: 1; height: 6px; background: var(--bg-subtle);
  border-radius: 99px; overflow: hidden;
}
.rm-avail-fill {
  height: 100%; border-radius: 99px;
  transition: width .4s ease;
}
.rm-section-label {
  font-size: .68rem; font-weight: 800; text-transform: uppercase;
  letter-spacing: .09em; color: var(--text-light);
  padding: 14px 20px 6px;
}
.rm-ing-list {
  list-style: none; padding: 0 20px 4px; margin: 0;
  display: flex; flex-direction: column; gap: 5px;
}
.rm-ing {
  display: flex; align-items: center; gap: 10px;
  padding: 7px 10px; border-radius: var(--r-sm);
  background: var(--bg-subtle);
  font-size: .85rem; font-weight: 500;
}
.rm-ing.ok {
  background: color-mix(in srgb, #22c55e 8%, var(--bg-subtle));
}
.rm-check {
  width: 18px; height: 18px; flex-shrink: 0;
  border-radius: 50%;
  background: var(--border-mid);
  display: flex; align-items: center; justify-content: center;
  font-size: .65rem; color: var(--bg-card);
  font-weight: 900;
}
.rm-ing.ok .rm-check {
  background: var(--success, #22c55e);
}
.rm-ing-name { flex: 1; min-width: 0; }
.rm-qty {
  font-size: .72rem;
  color: var(--text-light); font-weight: 700; white-space: nowrap;
}
.rm-steps {
  padding: 0 20px 8px 36px; margin: 0;
  display: flex; flex-direction: column; gap: 8px;
}
.rm-steps li {
  font-size: .87rem; line-height: 1.5; color: var(--text-2);
  padding: 6px 0; border-bottom: 1px dashed var(--border);
}
.rm-steps li:last-child { border-bottom: none; }
.rm-prep {
  padding: 4px 20px 12px;
  font-size: .87rem; line-height: 1.6; color: var(--text-2);
  white-space: pre-wrap;
}

/* ══════════════════════════════════════════════════
   28. PROGRESS BAR UTILITY (rc-progress)
══════════════════════════════════════════════════ */
.rc-progress-track {
  height: 6px; background: var(--bg-subtle);
  border-radius: var(--r-full); overflow: hidden;
}
.rc-progress-fill {
  height: 100%; background: var(--primary);
  border-radius: var(--r-full); transition: width .4s ease;
}

/* ══════════════════════════════════════════════════
   29. CALENDARIO TIMELINE
══════════════════════════════════════════════════ */
.calendar-bar-row {
  display: flex; align-items: center; gap: 6px; margin-bottom: 16px;
}
.calendar-bar {
  flex: 1; display: flex; gap: 5px;
  overflow-x: auto; scrollbar-width: none;
  -webkit-overflow-scrolling: touch; padding: 4px 2px;
}
.calendar-bar::-webkit-scrollbar { display: none; }

.cal-nav-btn {
  width: 32px; height: 32px; flex-shrink: 0;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-sm); cursor: pointer;
  font-size: 1.1rem; color: var(--text-mid);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
}
.cal-nav-btn:hover:not(:disabled) {
  background: var(--primary-light); color: var(--primary);
  border-color: var(--primary-mid);
}
.cal-nav-btn:disabled { opacity: .35; cursor: default; }

.cal-day {
  display: flex; flex-direction: column; align-items: center; gap: 2px;
  min-width: 46px; padding: 7px 5px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-lg); cursor: pointer; flex-shrink: 0;
  transition: all var(--t); position: relative;
}
.cal-day:hover { border-color: var(--primary-mid); background: var(--primary-xl); }
.cal-day.today { border-color: var(--primary); background: var(--primary-xl); }
.cal-day.active {
  background: var(--primary); border-color: var(--primary-dark);
  box-shadow: 0 3px 10px rgba(61,139,111,.3);
}
.cal-day.cal-past { opacity: .72; }

.cal-day-name {
  font-size: .56rem; font-weight: 800; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .05em;
}
.cal-day-num  { font-size: .96rem; font-weight: 800; color: var(--text); line-height: 1; }
.cal-day-month { font-size: .54rem; color: var(--text-light); }

.cal-day.active .cal-day-name,
.cal-day.active .cal-day-num,
.cal-day.active .cal-day-month { color: rgba(255,255,255,.9); }
.cal-day.today .cal-day-name,
.cal-day.today .cal-day-num    { color: var(--primary); }

.cal-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--primary); position: absolute; bottom: 4px;
}
.cal-day.active .cal-dot { background: rgba(255,255,255,.8); }

/* ══════════════════════════════════════════════════
   30. UNDO BAR
══════════════════════════════════════════════════ */
.undo-bar {
  position: fixed;
  bottom: calc(72px + env(safe-area-inset-bottom));
  left: 50%; transform: translateX(-50%) translateY(80px);
  display: flex; align-items: center; gap: 12px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-xl); padding: 10px 16px;
  box-shadow: var(--shadow-lg); z-index: 400;
  opacity: 0; transition: transform .28s ease, opacity .28s ease;
  white-space: nowrap; pointer-events: none;
}
.undo-bar.visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1; pointer-events: auto;
}
.undo-label {
  font-size: .82rem; font-weight: 600; color: var(--text-mid);
  max-width: 180px; overflow: hidden; text-overflow: ellipsis;
}

/* ══════════════════════════════════════════════════
   31. PASTI CONSUMATI (consumed-bar chips)
══════════════════════════════════════════════════ */
.consumed-bar {
  display: flex; flex-wrap: wrap; align-items: center; gap: 5px;
  padding: 8px 12px; margin-bottom: 10px;
  background: var(--bg-subtle); border-radius: var(--r-lg);
  border: 1px solid var(--border);
}
.consumed-bar-label {
  font-size: .66rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .06em;
}
.consumed-chip {
  display: inline-flex; align-items: center;
  padding: 3px 10px; border-radius: var(--r-full);
  background: #dcfce7; color: #166534;
  border: 1px solid #bbf7d0;
  font-size: .72rem; font-weight: 700;
}
[data-theme="dark"] .consumed-chip {
  background: #052e16; color: #4ade80; border-color: #14532d;
}
.consumed-chip-recipe {
  background: #f3e8ff; color: #6b21a8; border-color: #e9d5ff;
}
[data-theme="dark"] .consumed-chip-recipe {
  background: #2e1065; color: #c084fc; border-color: #4c1d95;
}

/* ══════════════════════════════════════════════════
   32. SETTINGS TOGGLE (dark mode switch)
══════════════════════════════════════════════════ */
.settings-toggle {
  width: 40px; height: 22px; flex-shrink: 0;
  background: var(--border-mid); border-radius: 11px;
  position: relative; display: inline-block;
  transition: background var(--t);
}
.settings-toggle::after {
  content: ''; position: absolute;
  width: 18px; height: 18px; border-radius: 50%;
  background: #fff; top: 2px; left: 2px;
  transition: transform var(--t);
  box-shadow: 0 1px 3px rgba(0,0,0,.25);
}
.settings-toggle.on { background: var(--primary); }
.settings-toggle.on::after { transform: translateX(18px); }

/* ══════════════════════════════════════════════════
   33. TUTORIAL MODAL
══════════════════════════════════════════════════ */
.tut-box { text-align: center; }
.tut-icon {
  font-size: 3.2rem; margin-bottom: 6px; display: block;
  animation: tutIconIn .4s ease;
}
@keyframes tutIconIn {
  from { transform: scale(.6); opacity: .2; }
  to   { transform: scale(1);  opacity: 1; }
}
.tut-counter {
  font-size: .7rem; font-weight: 700; color: var(--text-light);
  margin-bottom: 6px;
}
.tut-title {
  font-size: 1.12rem; font-weight: 800; margin-bottom: 12px;
  color: var(--text);
}
.tut-text {
  font-size: .88rem; color: var(--text-mid); line-height: 1.65;
  margin-bottom: 20px;
}
.tut-dots {
  display: flex; justify-content: center; gap: 7px; margin-bottom: 22px;
}
.tut-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--border-mid); transition: background var(--t);
}
.tut-dot.active { background: var(--primary); width: 22px; border-radius: 4px; }
.tut-actions {
  display: flex; gap: 10px; justify-content: center; margin-bottom: 14px;
}
.tut-skip { color: var(--text-light); border-color: var(--border); }
.tut-no-show-wrap {
  font-size: .82rem; color: var(--text-light); margin-top: 4px;
}
.tut-no-show-wrap label {
  display: flex; align-items: center; justify-content: center;
  gap: 6px; cursor: pointer;
}

/* ══════════════════════════════════════════════════
   34. STATS BAR — vertical (activity chart)
══════════════════════════════════════════════════ */
.stats-week-grid {
  display: grid; grid-template-columns: repeat(7,1fr);
  gap: 4px; align-items: flex-end;
}
.stats-day-bar {
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
.stats-bar-wrap {
  width: 100%; height: 70px;
  background: var(--bg-subtle);
  border-radius: var(--r-sm) var(--r-sm) 0 0;
  position: relative; overflow: hidden;
  display: flex; align-items: flex-end;
}
.stats-bar-fill {
  width: 100%; min-height: 3px;
  background: linear-gradient(180deg, var(--primary), var(--primary-dark));
  border-radius: var(--r-sm) var(--r-sm) 0 0;
  transition: height .5s ease;
}
.stats-day-label {
  font-size: .58rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .05em;
}
.stats-day-val  { font-size: .66rem; font-weight: 800; color: var(--text-mid); }
.stats-day-bar.today .stats-day-label { color: var(--primary); font-weight: 900; }
.stats-day-bar.today .stats-bar-fill  { box-shadow: 0 0 8px rgba(61,139,111,.4); }
@media (min-width: 768px) { .stats-bar-wrap { height: 90px; } }

/* ══════════════════════════════════════════════════
   35. LANDING PAGE — CTA auth-aware
══════════════════════════════════════════════════ */
.landing-cta-wrap {
  display: flex; flex-direction: column; align-items: center;
  gap: 14px; margin-top: 8px; width: 100%; max-width: 340px;
}
.landing-auth-loading {
  display: flex; align-items: center; gap: 10px;
  color: rgba(255,255,255,.55); font-size: .86rem;
}
.landing-auth-spinner {
  width: 16px; height: 16px;
  border: 2px solid rgba(255,255,255,.3);
  border-top-color: rgba(255,255,255,.85);
  border-radius: 50%;
  animation: spin .7s linear infinite; flex-shrink: 0;
}
@keyframes spin { to { transform: rotate(360deg); } }

.btn-landing-google {
  display: flex; align-items: center; justify-content: center; gap: 12px;
  width: 100%; padding: 14px 24px;
  background: #fff; color: #1a1a1a;
  border: none; border-radius: var(--r-lg);
  font-family: var(--font); font-size: .96rem; font-weight: 700;
  cursor: pointer; letter-spacing: .01em;
  box-shadow: 0 4px 24px rgba(0,0,0,.25);
  transition: all var(--t);
}
.btn-landing-google:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(0,0,0,.35);
}
.btn-landing-google:active { transform: scale(.97); }

.landing-offline-btn {
  background: none; border: none; cursor: pointer;
  color: rgba(255,255,255,.55); font-size: .8rem;
  font-family: var(--font); text-decoration: underline;
  padding: 4px 8px; transition: color var(--t);
}
.landing-offline-btn:hover { color: rgba(255,255,255,.85); }

.landing-nav-logged { width: 100%; max-width: 420px; margin-top: 8px; }
.landing-nav-logged-sub {
  font-size: .82rem; color: rgba(255,255,255,.6);
  margin-bottom: 14px; text-align: center;
}
.landing-nav-grid {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
@media (min-width: 480px) {
  .landing-nav-grid { grid-template-columns: repeat(2, 1fr); }
}
.landing-nav-card {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  padding: 18px 14px; background: rgba(255,255,255,.12);
  border: 1.5px solid rgba(255,255,255,.2); border-radius: var(--r-xl);
  color: #fff; font-family: var(--font); text-align: center;
  cursor: pointer; transition: all var(--t);
}
.landing-nav-card:hover {
  background: rgba(255,255,255,.2); border-color: rgba(255,255,255,.35);
  transform: translateY(-2px);
}
.landing-nav-card-icon { font-size: 2rem; line-height: 1; }
.landing-nav-card-label { font-size: 1rem; font-weight: 800; }
.landing-nav-card-desc {
  font-size: .7rem; opacity: .85; line-height: 1.3;
}

.edit-day-picker {
  padding: 24px 20px;
  background: var(--bg-subtle);
  border-radius: var(--r-xl);
  margin-bottom: 16px;
}

.landing-privacy-note {
  font-size: .7rem; color: rgba(255,255,255,.35);
  max-width: 300px; text-align: center; line-height: 1.5;
  margin-top: 8px;
}
.landing-privacy-note a { color: rgba(255,255,255,.55); text-decoration: underline; }

/* ══════════════════════════════════════════════════
   36. COOKIE CONSENT BANNER
══════════════════════════════════════════════════ */
.cookie-banner {
  position: fixed; bottom: 0; left: 0; right: 0;
  z-index: 9000;
  background: var(--bg-card);
  border-top: 1.5px solid var(--border);
  box-shadow: 0 -4px 30px rgba(0,0,0,.12);
  transform: translateY(100%);
  transition: transform .35s cubic-bezier(.4,0,.2,1);
  padding: env(safe-area-inset-bottom) 0 0;
}
.cookie-banner.visible { transform: translateY(0); }

.cookie-banner-inner {
  max-width: 900px; margin: 0 auto;
  display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  padding: 16px 20px;
}
.cookie-banner-text {
  display: flex; align-items: flex-start; gap: 12px; flex: 1; min-width: 240px;
}
.cookie-banner-icon { font-size: 1.8rem; flex-shrink: 0; }
.cookie-banner-text strong { display: block; font-weight: 800; margin-bottom: 4px; font-size: .9rem; }
.cookie-banner-text p  { font-size: .78rem; color: var(--text-mid); line-height: 1.5; margin: 0; }
.cookie-banner-actions { display: flex; gap: 8px; flex-shrink: 0; flex-wrap: wrap; }

/* ══════════════════════════════════════════════════
   37. TUTORIAL CARD + SPOTLIGHT
══════════════════════════════════════════════════ */
/* Spotlight: overlay attorno all'elemento target */
#tutSpotlight {
  display: none;
  position: fixed; z-index: 590;
  border-radius: var(--r-lg);
  box-shadow: 0 0 0 100vmax rgba(0,0,0,.65);
  pointer-events: none;
  transition: left .32s ease, top .32s ease, width .32s ease, height .32s ease;
  outline: 3px solid var(--primary);
  outline-offset: 2px;
  animation: spotPulse 2s ease-in-out infinite;
}
@keyframes spotPulse {
  0%, 100% { outline-color: var(--primary); }
  50%       { outline-color: var(--primary-mid); }
}

/* Animated pointer */
#tutPointer {
  display: none;
  position: fixed; z-index: 592;
  font-size: 1.9rem;
  pointer-events: none;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.4));
  animation: tutBounce 1s ease-in-out infinite;
}
@keyframes tutBounce {
  0%, 100% { transform: translateY(0); }
  50%       { transform: translateY(-8px); }
}

/* Tutorial floating card */
#tutCard {
  display: none;
  position: fixed; z-index: 600;
  background: var(--bg-card);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  padding: 18px 20px 16px;
  box-shadow: var(--shadow-lg);
  width: 320px; max-width: calc(100vw - 32px);
  animation: tutCardIn .25s ease;
}
@keyframes tutCardIn {
  from { opacity: 0; transform: translateY(8px) scale(.97); }
  to   { opacity: 1; transform: none; }
}
.tut-card-top {
  display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
}
.tut-card-icon  { font-size: 1.6rem; flex-shrink: 0; }
.tut-card-step-lbl {
  flex: 1; font-size: .65rem; font-weight: 700;
  color: var(--text-light); text-transform: uppercase; letter-spacing: .08em;
}
.tut-card-close {
  width: 26px; height: 26px; border-radius: var(--r-sm);
  background: var(--bg-subtle); border: 1px solid var(--border);
  cursor: pointer; font-size: .78rem; color: var(--text-light);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
}
.tut-card-close:hover { background: var(--danger); color: #fff; border-color: var(--danger); }

.tut-dots-mini {
  display: flex; gap: 5px; margin-bottom: 10px;
}
.tut-dots-mini .tut-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--border-mid); transition: all var(--t);
}
.tut-dots-mini .tut-dot.active {
  background: var(--primary); width: 18px; border-radius: 3px;
}

.tut-card-title {
  font-size: .96rem; font-weight: 800; margin-bottom: 7px; color: var(--text);
}
.tut-card-text  {
  font-size: .81rem; color: var(--text-mid); line-height: 1.6; margin-bottom: 10px;
}
.tut-card-hint  {
  display: flex; align-items: center; gap: 6px;
  font-size: .74rem; font-weight: 700; color: var(--primary);
  background: var(--primary-light); border-radius: var(--r-sm);
  padding: 5px 10px; margin-bottom: 12px;
  border: 1px solid var(--primary-mid);
}
.tut-card-footer {
  display: flex; align-items: center; gap: 10px;
}
.tut-no-show-wrap {
  font-size: .76rem; color: var(--text-light); flex: 1;
  display: flex; align-items: center; gap: 5px; cursor: pointer;
}

/* ══════════════════════════════════════════════════
   38. ONBOARDING OVERLAY
══════════════════════════════════════════════════ */
.onboarding-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 700;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(4px);
  align-items: center; justify-content: center;
  padding: 16px;
}
.onboarding-overlay.active { display: flex; }

.onboarding-box {
  background: var(--bg-card);
  border-radius: var(--r-2xl);
  width: 100%; max-width: 640px;
  max-height: calc(100dvh - 32px);
  display: flex; flex-direction: column;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  animation: obBoxIn .3s ease;
}
@keyframes obBoxIn {
  from { opacity: 0; transform: scale(.96) translateY(16px); }
  to   { opacity: 1; transform: none; }
}

.onboarding-header {
  padding: 24px 24px 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.onboarding-step-label {
  font-size: .66rem; font-weight: 700; color: var(--primary);
  text-transform: uppercase; letter-spacing: .1em; margin-bottom: 6px;
}
.onboarding-title {
  font-size: 1.15rem; font-weight: 800; margin-bottom: 6px;
}
.onboarding-sub {
  font-size: .8rem; color: var(--text-mid); line-height: 1.5;
}

/* Tabs pasto */
.ob-tabs {
  display: flex; gap: 4px; overflow-x: auto; scrollbar-width: none;
  padding: 12px 16px 0; flex-shrink: 0;
}
.ob-tabs::-webkit-scrollbar { display: none; }
.ob-tab {
  display: flex; align-items: center; gap: 5px;
  padding: 7px 14px; border-radius: var(--r-full);
  border: 1.5px solid var(--border);
  background: var(--bg-subtle); color: var(--text-mid);
  font-family: var(--font); font-size: .8rem; font-weight: 700;
  cursor: pointer; white-space: nowrap; flex-shrink: 0;
  transition: all var(--t); position: relative;
}
.ob-tab:hover { border-color: var(--primary-mid); color: var(--primary); }
.ob-tab.active {
  background: var(--primary); border-color: var(--primary-dark); color: #fff;
  box-shadow: 0 2px 10px rgba(61,139,111,.3);
}
.ob-tab-badge {
  background: rgba(255,255,255,.3);
  color: #fff; border-radius: var(--r-full);
  padding: 1px 7px; font-size: .68rem; font-weight: 800;
}
.ob-tab:not(.active) .ob-tab-badge {
  background: var(--primary-light); color: var(--primary);
}

/* Content area */
.ob-content {
  flex: 1; overflow-y: auto; padding: 16px 20px;
}

/* PIANO_GEN — grafici */
.pg-pie-row {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}
.pg-pie {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  box-shadow: 0 4px 14px rgba(0,0,0,.15);
  border: 2px solid var(--border);
}
[data-theme="dark"] .pg-pie {
  box-shadow: 0 8px 18px rgba(0,0,0,.35);
  border-color: rgba(255,255,255,.12);
}
.pg-pie-legend {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: .8rem;
  color: var(--text-2);
}
.pg-dot {
  display: inline-block;
  width: 9px;
  height: 9px;
  border-radius: 50%;
  margin-right: 6px;
}
.pg-macro-grid {
  display: grid;
  grid-template-columns: repeat(5, minmax(0,1fr));
  gap: 10px;
}
@media (max-width: 900px) {
  .pg-macro-grid { grid-template-columns: repeat(3, minmax(0,1fr)); }
}
@media (max-width: 640px) {
  .pg-macro-grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
}
.pg-macro-card {
  padding: 10px 10px 8px;
  border-radius: 14px;
  border: 1px solid color-mix(in srgb,var(--border) 50%,transparent);
  background: color-mix(in srgb,var(--bg-card) 80%,transparent);
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;
}
.pg-macro-title {
  font-size: .8rem;
  font-weight: 600;
  color: var(--text-mid);
}
.pg-macro-pie {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  box-shadow: 0 2px 10px rgba(0,0,0,.12);
  border: 1px solid var(--border);
}
[data-theme="dark"] .pg-macro-pie {
  box-shadow: 0 4px 12px rgba(0,0,0,.35);
}
.pg-macro-legend {
  display: flex;
  flex-direction: column;
  gap: 2px;
  font-size: .72rem;
  color: var(--text-2);
  text-align: left;
}
.ob-step0-wrap {
  display: flex;
  flex-direction: column;
  gap: 18px;
  padding-top: 8px;
}
.ob-step0-intro {
  font-size: .86rem;
  color: var(--text-mid);
  text-align: left;
  margin: 0 0 4px;
}
.ob-step0-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
@media (max-width: 640px) {
  .ob-step0-grid {
    grid-template-columns: 1fr;
  }
}
.ob-step0-card {
  position: relative;
  padding: 18px 18px 14px;
  border-radius: 22px;
  border: 1px solid color-mix(in srgb, var(--border) 40%, transparent);
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--bg-card) 70%, transparent),
    color-mix(in srgb, var(--primary) 12%, transparent)
  );
  box-shadow: 0 18px 40px rgba(0,0,0,.35);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  overflow: hidden;
}
@media (max-width: 640px) {
  .ob-step0-card {
    padding: 16px 14px 12px;
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--bg-card) 88%, transparent),
      color-mix(in srgb, var(--primary) 8%, transparent)
    );
    box-shadow: 0 10px 28px rgba(0,0,0,.25);
  }
}
.ob-step0-icon {
  font-size: 1.6rem;
  margin-bottom: 6px;
}
.ob-step0-title {
  font-size: 1rem;
  font-weight: 800;
  margin-bottom: 4px;
}
.ob-step0-sub {
  font-size: .82rem;
  color: var(--text-light);
  line-height: 1.5;
  margin-bottom: 14px;
}
.ob-step0-cta {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 16px;
  min-height: 44px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--border) 60%, transparent);
  background: color-mix(in srgb, var(--bg-card) 70%, transparent);
  color: var(--text);
  font-size: .86rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--t);
}
.ob-step0-cta:hover {
  background: color-mix(in srgb, var(--primary) 14%, var(--bg-card));
  border-color: color-mix(in srgb, var(--primary-mid) 60%, var(--border));
  box-shadow: 0 6px 18px rgba(0,0,0,.30);
}
@media (max-width: 640px) {
  .ob-step0-cta {
    padding: 12px 18px;
    font-size: .9rem;
  }
}
.ob-meal-header {
  display: flex; align-items: center; gap: 8px; margin-bottom: 14px;
}
.ob-meal-emoji { font-size: 1.4rem; }
.ob-meal-label { font-size: 1rem; font-weight: 800; }

.ob-section-lbl {
  font-size: .64rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .08em; margin-bottom: 8px; margin-top: 14px;
}
.ob-section-lbl:first-of-type { margin-top: 0; }

.ob-presets-wrap { display: flex; flex-wrap: wrap; gap: 7px; }
.ob-chip {
  padding: 6px 14px; border-radius: var(--r-full);
  border: 1.5px solid var(--border);
  background: var(--bg-subtle); color: var(--text-mid);
  font-family: var(--font); font-size: .8rem; font-weight: 600;
  cursor: pointer; transition: all var(--t);
}
.ob-chip:hover { border-color: var(--primary-mid); color: var(--primary); }
.ob-chip.on {
  background: var(--primary-light); border-color: var(--primary-mid);
  color: var(--primary); font-weight: 700;
}

.ob-custom-row {
  display: flex; gap: 8px; align-items: center;
}
.ob-custom-input {
  flex: 1; padding: 9px 13px;
  border: 1.5px solid var(--border); border-radius: var(--r);
  background: var(--bg-card); color: var(--text);
  font-family: var(--font); font-size: .85rem;
  outline: none; transition: border-color var(--t);
}
.ob-custom-input:focus { border-color: var(--primary); }

.ob-added-wrap { display: flex; flex-wrap: wrap; gap: 6px; min-height: 32px; }
.ob-added-chip {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 10px 4px 12px;
  background: var(--primary-light); border: 1px solid var(--primary-mid);
  border-radius: var(--r-full); color: var(--primary);
  font-size: .78rem; font-weight: 700;
}
.ob-added-chip button {
  background: none; border: none; cursor: pointer;
  color: var(--primary); font-size: .72rem; padding: 0;
  line-height: 1; opacity: .7; transition: opacity var(--t);
}
.ob-added-chip button:hover { opacity: 1; }
.ob-empty-note { font-size: .8rem; color: var(--text-light); }

/* Footer */
.onboarding-footer {
  padding: 14px 20px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}
.ob-warn-empty {
  font-size: .8rem; color: var(--warning);
  background: #fffbeb; border: 1px solid #fde68a;
  border-radius: var(--r-sm); padding: 8px 12px;
  margin-bottom: 10px;
}
.onboarding-footer-actions {
  display: flex; gap: 10px; justify-content: flex-end;
}
@media (max-width: 480px) {
  .onboarding-footer-actions { flex-direction: column-reverse; }
  .onboarding-footer-actions .btn { width: 100%; }
}

/* ══════════════════════════════════════════════════
   39. WELCOME MODAL
══════════════════════════════════════════════════ */
.welcome-box { max-width: 560px; }
.welcome-header {
  text-align: center; padding: 4px 0 16px; border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
}
.welcome-header-icon  { font-size: 2.8rem; margin-bottom: 8px; }
.welcome-header-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 6px; }
.welcome-header-sub   { font-size: .82rem; color: var(--text-mid); }

.welcome-cards-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
@media (max-width: 460px) { .welcome-cards-grid { grid-template-columns: 1fr; } }

.welcome-card {
  padding: 16px; border-radius: var(--r-lg);
  border: 1.5px solid var(--border);
  background: var(--bg-subtle);
  cursor: pointer; transition: all var(--t);
  display: flex; flex-direction: column; gap: 5px;
}
.welcome-card:hover {
  border-color: var(--primary-mid);
  background: var(--primary-xl);
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}
.welcome-card-icon  { font-size: 1.8rem; }
.welcome-card-title { font-size: .9rem; font-weight: 800; color: var(--text); }
.welcome-card-desc  { font-size: .76rem; color: var(--text-mid); line-height: 1.5; }
.welcome-card-cta   {
  font-size: .74rem; font-weight: 700; color: var(--primary);
  margin-top: 6px;
}

/* ══════════════════════════════════════════════════
   40. DISPENSA — pulsante aggiungi per categoria + modal lista
══════════════════════════════════════════════════ */
.fi-group-header {
  position: relative;
}
.fi-add-cat-btn {
  display: flex; align-items: center; justify-content: center;
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--primary-light, #dcfce7);
  color: var(--primary);
  border: none; cursor: pointer; font-size: 1rem;
  font-weight: 700; flex-shrink: 0;
  transition: background var(--t), transform var(--t);
  margin-left: auto;
}
.fi-add-cat-btn:hover {
  background: var(--primary);
  color: #fff;
  transform: scale(1.1);
}

.fi-empty-cat {
  padding: 8px 16px 4px;
  font-size: .8em;
  color: var(--text-3);
  font-style: italic;
}

.fi-in-fridge-badge {
  font-size: .72em;
  color: var(--success, #16a34a);
  font-weight: 600;
}

/* Lista ingredienti per categoria (addByCatModal) */
.add-by-cat-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 12px; border-bottom: 1px solid var(--border);
  cursor: pointer; border-radius: var(--r-md); transition: background var(--t);
  font-size: .92em;
}
.add-by-cat-item:hover { background: var(--primary-xl); }
.add-by-cat-item.in-fridge { color: var(--text-3); }

/* ══════════════════════════════════════════════════
   41. PIANO — sostituzione ingrediente migliorata
══════════════════════════════════════════════════ */
.sub-opt-btn {
  display: flex; align-items: center;
  width: 100%; text-align: left;
  padding: 10px 14px; margin-bottom: 8px;
  background: var(--bg-subtle); border: 1.5px solid var(--border);
  border-radius: var(--r-md); cursor: pointer; font-size: .9em; font-weight: 500;
  transition: border-color var(--t), background var(--t);
}
.sub-opt-available:hover {
  border-color: var(--primary);
  background: var(--primary-xl);
}

.sub-opt-suggestion {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 4px; border-bottom: 1px solid var(--border);
  gap: 10px;
}
.sub-opt-name { font-size: .9em; font-weight: 500; flex: 1; }
.sub-opt-actions { display: flex; gap: 6px; flex-shrink: 0; }
.sub-opt-actions .btn { font-size: .72em; padding: 4px 8px; }

/* ══════════════════════════════════════════════════
   42. ONBOARDING — sezione limiti
══════════════════════════════════════════════════ */
.ob-limiti-wrap {
  background: var(--bg-subtle);
  border: 1.5px solid var(--border);
  border-radius: var(--r-lg);
  padding: 16px 18px;
  margin-top: 4px;
}

/* ══════════════════════════════════════════════════
   43. DISPENSA — tasto aggiungi inline nella categoria
══════════════════════════════════════════════════ */
.fi-add-inline-btn {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  width: 100%; padding: 9px 16px;
  background: color-mix(in srgb, var(--gc, var(--primary)) 5%, var(--bg-card));
  border: none; border-top: 1px dashed color-mix(in srgb, var(--gc, var(--primary)) 25%, var(--border));
  color: var(--gc, var(--primary));
  font-size: .8rem; font-weight: 700;
  cursor: pointer; transition: background var(--t), opacity var(--t);
  letter-spacing: .02em;
}
.fi-add-inline-btn:hover {
  background: color-mix(in srgb, var(--gc, var(--primary)) 12%, var(--bg-card));
}

/* "Aggiungi ingrediente personalizzato" dentro addByCatModal / paIngModal */
.add-by-cat-new-btn {
  display: flex; align-items: center; gap: 7px;
  width: 100%; padding: 10px 12px;
  background: var(--primary-xl);
  border: 1.5px dashed var(--primary-mid);
  border-radius: var(--r-md);
  color: var(--primary); font-size: .85rem; font-weight: 700;
  cursor: pointer; transition: all var(--t);
  margin-bottom: 8px;
}
.add-by-cat-new-btn:hover {
  background: var(--primary-light);
  border-color: var(--primary);
}

/* ══════════════════════════════════════════════════
   44. PIANO ALIMENTARE — pagina dedicata
══════════════════════════════════════════════════ */

/* Blocco pasto */
.pa-meal-block {
  background: var(--bg-card);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  overflow: hidden;
  margin-bottom: 12px;
}

.pa-meal-header {
  display: flex; align-items: center; gap: 10px;
  padding: 14px 16px;
  cursor: pointer; transition: background var(--t);
  background: var(--bg-card);
  user-select: none;
}
.pa-meal-header:hover { background: var(--bg-hover); }

.pa-meal-emoji  { font-size: 1.4rem; flex-shrink: 0; }
.pa-meal-label  { flex: 1; font-size: .95rem; font-weight: 800; }
.pa-meal-count  {
  font-size: .72rem; font-weight: 700;
  color: var(--text-light);
  background: var(--bg-subtle);
  padding: 2px 10px; border-radius: var(--r-full);
  border: 1px solid var(--border);
}
.pa-meal-chevron {
  font-size: .9rem; color: var(--text-light);
  transition: transform var(--t); flex-shrink: 0;
}

.pa-meal-body {
  display: none;
  border-top: 1px solid var(--border);
}
.pa-meal-body.open { display: block; }

/* Generatore piano: validazione step 1 */
input.invalid {
  border-color: var(--danger, #dc2626) !important;
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.15);
}
.pg-field-error {
  display: block;
  font-size: .75rem;
  color: var(--danger, #dc2626);
  margin-top: 4px;
  min-height: 1.2em;
}

/* Step 2: distribuzione pasti — leggibile su mobile */
.pg-step2-dist {
  display: flex;
  flex-wrap: wrap;
  gap: 4px 8px;
  align-items: baseline;
}
.pg-step2-dist-item::after { content: ' · '; }
.pg-step2-dist-item:last-child::after { content: ''; }
@media (max-width: 380px) {
  .pg-step2-dist { flex-direction: column; gap: 2px; }
  .pg-step2-dist-item::after { content: ''; }
}

/* Step 3: CTA secondarie come link testuali */
.pg-expand-collapse-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}
.pg-link-action {
  background: none;
  border: none;
  padding: 0;
  font-size: .85em;
  color: var(--text-2, #64748b);
  cursor: pointer;
  text-decoration: none;
  font-family: inherit;
}
.pg-link-action:hover {
  color: var(--primary);
  text-decoration: underline;
}
.pg-link-action-sep {
  color: var(--text-3);
  font-size: .8em;
  user-select: none;
}

/* Sezione categoria dentro pasto */
.pa-cat-section {
  border-bottom: 1px solid var(--border);
  padding: 0;
}
.pa-cat-section:last-child { border-bottom: none; }

.pa-cat-header {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 16px;
  background: color-mix(in srgb, var(--pc, var(--primary)) 5%, var(--bg-card));
}
.pa-cat-icon  { font-size: 1.1rem; flex-shrink: 0; }
.pa-cat-label {
  flex: 1; font-size: .72rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: .07em;
  color: var(--pc, var(--primary));
}
.pa-cat-count {
  font-size: .68rem; font-weight: 800;
  background: color-mix(in srgb, var(--pc, var(--primary)) 14%, transparent);
  color: var(--pc, var(--primary));
  border: 1px solid color-mix(in srgb, var(--pc, var(--primary)) 25%, transparent);
  padding: 1px 8px; border-radius: var(--r-full);
}

/* Tasto + Aggiungi nella categoria */
.pa-cat-add-btn {
  padding: 5px 12px;
  background: color-mix(in srgb, var(--pc, var(--primary)) 10%, transparent);
  border: 1.5px solid color-mix(in srgb, var(--pc, var(--primary)) 30%, transparent);
  border-radius: var(--r-full);
  color: var(--pc, var(--primary));
  font-size: .76rem; font-weight: 800;
  cursor: pointer; transition: all var(--t);
  flex-shrink: 0;
}
.pa-cat-add-btn:hover {
  background: color-mix(in srgb, var(--pc, var(--primary)) 20%, transparent);
}

/* Items */
.pa-cat-items { display: flex; flex-direction: column; }

/* Riga ingrediente */
.pa-ing-row {
  border-bottom: 1px solid var(--border);
  padding: 0;
}
.pa-ing-row:last-child { border-bottom: none; }

.pa-ing-main {
  display: flex; align-items: center;
  padding: 10px 16px; gap: 10px;
}
.pa-ing-info  { flex: 1; min-width: 0; }
.pa-ing-name  { font-size: .88rem; font-weight: 700; display: block; }
.pa-ing-qty   { font-size: .72rem; color: var(--text-light); font-weight: 600; display: block; margin-top: 2px; }

.pa-ing-actions { display: flex; gap: 5px; flex-shrink: 0; }

/* Toggle alternative */
.pa-alt-toggle {
  padding: 5px 10px;
  background: var(--bg-subtle); border: 1.5px solid var(--border);
  border-radius: var(--r-full);
  font-size: .72rem; font-weight: 700; color: var(--text-mid);
  cursor: pointer; transition: all var(--t);
}
.pa-alt-toggle:hover,
.pa-alt-toggle.active {
  background: var(--primary-light); color: var(--primary);
  border-color: var(--primary-mid);
}

/* Tasto rimuovi ingrediente */
.pa-ing-del {
  width: 26px; height: 26px;
  background: none; border: none; cursor: pointer;
  font-size: .72rem; color: var(--text-light);
  border-radius: var(--r-xs);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t); flex-shrink: 0;
}
.pa-ing-del:hover { color: var(--danger); background: #fee2e2; }

/* Sezione alternative (collassabile) */
.pa-alt-section {
  display: none;
  padding: 4px 16px 10px 32px;
  border-top: 1px dashed var(--border);
  background: var(--bg-subtle);
  flex-direction: column; gap: 4px;
}
.pa-alt-section.open { display: flex; }

/* Riga alternativa */
.pa-alt-row {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 10px;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--r-md);
}
.pa-alt-bullet { font-size: .9rem; color: var(--text-light); flex-shrink: 0; }
.pa-alt-info   { flex: 1; min-width: 0; }
.pa-alt-name   { font-size: .82rem; font-weight: 600; display: block; }
.pa-alt-qty    { font-size: .7rem; color: var(--text-light); font-weight: 600; display: block; }
.pa-alt-del {
  width: 22px; height: 22px;
  background: none; border: none; cursor: pointer;
  font-size: .65rem; color: var(--text-light);
  border-radius: var(--r-xs);
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t); flex-shrink: 0;
}
.pa-alt-del:hover { color: var(--danger); background: #fee2e2; }

/* Tasto aggiungi alternativa */
.pa-add-alt-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 7px 10px; margin-top: 4px;
  background: none;
  border: 1.5px dashed var(--primary-mid);
  border-radius: var(--r-md);
  color: var(--primary); font-size: .78rem; font-weight: 700;
  cursor: pointer; transition: all var(--t);
}
.pa-add-alt-btn:hover {
  background: var(--primary-xl);
}

/* Sezione limiti in fondo alla pagina */
.pa-limiti-section {
  background: var(--bg-card);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  overflow: hidden;
  margin-top: 20px;
}
.pa-limiti-header {
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  background: color-mix(in srgb, var(--primary) 5%, var(--bg-card));
}
.pa-limiti-icon  { font-size: 1.2rem; flex-shrink: 0; }
.pa-limiti-title { font-size: .88rem; font-weight: 800; flex: 1; min-width: 0; }
.pa-limiti-sub   { font-size: .72rem; color: var(--text-light); flex-shrink: 0; }
.pa-limiti-body  { padding: 8px 0; }

.pa-limit-row {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 14px;
  border-bottom: 1px solid var(--border);
  min-width: 0; flex-wrap: wrap;
}
.pa-limit-row:last-child { border-bottom: none; }

.pa-limit-icon  { font-size: 1.1rem; flex-shrink: 0; width: 24px; text-align: center; }
.pa-limit-info  { flex: 1; min-width: 100px; display: flex; flex-direction: column; gap: 1px; }
.pa-limit-label { font-size: .84rem; font-weight: 600; color: var(--text); word-break: break-word; }
.pa-limit-unit  { font-size: .68rem; color: var(--text-light); }
.pa-limit-right { display: flex; align-items: center; gap: 5px; flex-shrink: 0; margin-left: auto; }
.pa-limit-cur   { display: none; } /* nascosto per risparmiare spazio su mobile */
.pa-limit-max-label { font-size: .7rem; font-weight: 700; color: var(--text-light); }
.pa-limit-input {
  width: 58px; text-align: center;
  padding: 5px 6px;
  border: 1.5px solid var(--border);
  border-radius: var(--r-md);
  background: var(--bg); color: var(--text);
  font-size: .88rem; font-weight: 700;
  flex-shrink: 0;
}
@media (min-width: 480px) {
  .pa-limit-cur { display: block; }
}
.pa-limit-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-xl);
}

/* ══════════════════════════════════════════════════
   45. RICETTE — badge extra piano
══════════════════════════════════════════════════ */
.badge-extra {
  background: #fef3c7; color: #92400e; border-color: #fde68a;
}
.badge-inpiano {
  background: #dcfce7; color: #166534; border-color: #bbf7d0;
}
[data-theme="dark"] .badge-extra   { background: #2d1b00; color: #fcd34d; border-color: #78350f; }
[data-theme="dark"] .badge-inpiano { background: #052e16; color: #4ade80; border-color: #14532d; }

/* Ingredienti extra piano nella lista accordion */
.rc-acc-item.extra-piano {
  opacity: .6;
}
.rc-acc-item.extra-piano .rc-acc-name {
  color: var(--text-light);
  font-weight: 500;
}
.rc-acc-extra-tag {
  font-size: .62rem; font-weight: 800;
  padding: 1px 6px; border-radius: var(--r-full);
  background: #fef3c7; color: #92400e;
  border: 1px solid #fde68a; flex-shrink: 0;
  margin-left: auto;
}
[data-theme="dark"] .rc-acc-extra-tag {
  background: #2d1b00; color: #fcd34d; border-color: #78350f;
}

/* Modal ricetta — ingredienti extra piano */
.rm-extra-notice {
  background: #fef3c7; color: #92400e;
  border: 1px solid #fde68a; border-radius: var(--r-md);
  padding: 9px 14px; font-size: .82rem; font-weight: 700;
  margin-bottom: 10px;
}
[data-theme="dark"] .rm-extra-notice {
  background: #2d1b00; color: #fcd34d; border-color: #78350f;
}

.rm-ing.rm-extra {
  opacity: .65;
}
.rm-ing.rm-extra .rm-ing-name {
  color: var(--text-light);
}
.rm-extra-tag {
  font-size: .65rem; font-weight: 800;
  padding: 1px 7px; border-radius: var(--r-full);
  background: #fef3c7; color: #92400e;
  border: 1px solid #fde68a; flex-shrink: 0;
  margin-left: auto;
}
[data-theme="dark"] .rm-extra-tag {
  background: #2d1b00; color: #fcd34d; border-color: #78350f;
}

/* ══════════════════════════════════════════════════
   43. LIMITI SETTIMANALI — GRIGLIA DISPLAY
══════════════════════════════════════════════════ */
.limits-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  gap: 10px;
  padding: 4px 0;
}
.limit-card {
  display: flex; flex-direction: column; align-items: center;
  padding: 14px 8px 10px;
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-lg); text-align: center;
  transition: border-color var(--t);
}
.limit-card.warning { border-color: #f59e0b; }
.limit-card.exceeded { border-color: #ef4444; }
.limit-card-icon { font-size: 1.4rem; margin-bottom: 4px; }
.limit-card-name {
  font-size: .72rem; font-weight: 700; color: var(--text);
  width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  margin-bottom: 8px;
}
.limit-progress-bar {
  width: 100%; height: 5px;
  background: var(--border); border-radius: 3px; overflow: hidden;
  margin-bottom: 6px;
}
.limit-progress-fill { height: 100%; border-radius: 3px; background: var(--primary); transition: width .3s ease; }
.limit-progress-fill.warning { background: #f59e0b; }
.limit-progress-fill.exceeded { background: #ef4444; }
.limit-text { font-size: .68rem; font-weight: 600; color: var(--text-2); white-space: nowrap; }
.limit-text.warning { color: #f59e0b; }
.limit-text.exceeded { color: #ef4444; }

/* ══════════════════════════════════════════════════
   44. FIX TESTO SOSTITUZIONE INGREDIENTE (dark mode)
══════════════════════════════════════════════════ */
.sub-opt-btn { color: var(--text); }
[data-theme="dark"] .sub-opt-btn { color: var(--text); }

/* ══════════════════════════════════════════════════
   45. CALENDARIO — fade laterale + day number fix
══════════════════════════════════════════════════ */
.calendar-bar {
  -webkit-mask-image: linear-gradient(to right, transparent 0%, #000 7%, #000 93%, transparent 100%);
  mask-image: linear-gradient(to right, transparent 0%, #000 7%, #000 93%, transparent 100%);
  scroll-behavior: smooth;
}
.cal-day-num { color: var(--text) !important; }
.cal-day.active .cal-day-num { color: #fff !important; }
.cal-day.today:not(.active) .cal-day-num { color: var(--primary) !important; }
/* Fade per distanza dal giorno selezionato */
.cal-day.cal-d1   { opacity: .82; }
.cal-day.cal-d2   { opacity: .60; }
.cal-day.cal-d3   { opacity: .40; }
.cal-day.cal-dfar { opacity: .22; }
/* Il giorno oggi è sempre ben visibile anche quando non è quello attivo */
.cal-day.today    { opacity: 1 !important; }

/* ══════════════════════════════════════════════════
   46. DISPENSA — empty state con pulsante interno
══════════════════════════════════════════════════ */
.fi-empty-cat {
  display: flex; flex-direction: column; align-items: flex-start;
  gap: 10px; padding: 12px 16px;
}
.fi-empty-cat-text {
  font-size: .82em; color: var(--text-3); font-style: italic;
}

/* ══════════════════════════════════════════════════
   47. STORICO — fix overflow badge
══════════════════════════════════════════════════ */
.rc-accordion-card { overflow: visible !important; }
.rc-accordion-body { overflow: visible; }
.storico-pills-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
.storico-pill {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 4px 10px; border-radius: var(--r-full);
  font-size: .78em; font-weight: 600;
  background: var(--primary-light); color: var(--primary);
  max-width: 100%; word-break: break-word; white-space: normal;
  line-height: 1.3;
}
.storico-pill-sub {
  background: #fff3cd; color: #856404;
}

/* ══════════════════════════════════════════════════
   48. PROFILO — immagine profilo
══════════════════════════════════════════════════ */
.profilo-avatar {
  width: 52px; height: 52px; border-radius: 50%;
  object-fit: cover; border: 2px solid var(--primary);
  display: block;
}
.profilo-avatar-placeholder {
  width: 52px; height: 52px; border-radius: 50%;
  background: var(--primary-light);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem;
}

/* ══════════════════════════════════════════════════
   49. NAV — foto profilo nel tab
══════════════════════════════════════════════════ */
.nav-avatar {
  width: 24px; height: 24px; border-radius: 50%;
  object-fit: cover; border: 1.5px solid var(--primary);
  display: inline-block; vertical-align: middle;
  flex-shrink: 0;
}

/* ══════════════════════════════════════════════════
   50. WIZARD PIANO ALIMENTARE
   (z-index spostato in sezione 54 — deve stare sotto .modal)
══════════════════════════════════════════════════ */
.wizard-header {
  display: flex; align-items: center; gap: 12px;
  padding: 14px 18px; border-bottom: 1px solid var(--border);
  flex-shrink: 0; background: var(--bg-card);
}
.wizard-step-info {
  flex: 1; font-weight: 700; font-size: .95rem;
}
.wizard-step-sub { font-size: .78rem; color: var(--text-light); font-weight: 400; }
.wizard-body {
  flex: 1; overflow-y: auto; padding: 16px;
}
.wizard-footer {
  display: flex; gap: 10px; padding: 14px 16px;
  border-top: 1px solid var(--border);
  background: var(--bg-card); flex-shrink: 0;
}
.wizard-footer .btn { flex: 1; }
.wizard-progress {
  display: flex; gap: 4px; align-items: center; justify-content: center;
  padding: 8px 0;
}
.wizard-progress-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--border); transition: background var(--t);
}
.wizard-progress-dot.active { background: var(--primary); }
.wizard-progress-dot.done { background: var(--primary-mid); }
.wizard-meal-title {
  display: flex; align-items: center; gap: 10px;
  font-size: 1.1rem; font-weight: 800; margin-bottom: 14px;
  color: var(--text);
}
.wizard-current-ings {
  background: var(--bg-card); border: 1.5px solid var(--border);
  border-radius: var(--r-lg); padding: 12px 14px; margin-bottom: 14px;
}
.wizard-ings-label {
  font-size: .78rem; font-weight: 700; color: var(--text-light);
  text-transform: uppercase; letter-spacing: .05em; margin-bottom: 8px;
}
.wizard-ing-chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 10px; background: var(--primary-xl);
  border: 1px solid var(--primary-mid); border-radius: var(--r-full);
  font-size: .82rem; margin: 3px; cursor: pointer;
}
.wizard-ing-chip:hover { background: var(--primary-light); }
.wizard-ing-chip-del { color: var(--danger); font-size: 1rem; line-height: 1; }
.wizard-empty-ings {
  color: var(--text-3); font-size: .85rem; font-style: italic;
  padding: 8px 0;
}
.wizard-cats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  gap: 8px; margin-bottom: 14px;
}
.wizard-cat-btn {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 12px; background: var(--bg-card);
  border: 1.5px solid var(--border); border-radius: var(--r-lg);
  cursor: pointer; font-size: .85rem; font-weight: 600;
  transition: all var(--t); color: var(--text);
}
.wizard-cat-btn:hover { border-color: var(--primary); background: var(--primary-xl); }
.wizard-limits-form { background: var(--bg-card); border: 1.5px solid var(--border); border-radius: var(--r-lg); overflow: hidden; }

/* ══════════════════════════════════════════════════
   51. ALREADY SELECTED BADGE (piano)
══════════════════════════════════════════════════ */
.already-selected-badge {
  display: inline-flex; align-items: center; gap: 3px;
  font-size: .65rem; font-weight: 700; padding: 2px 6px;
  border-radius: var(--r-full);
  background: #fef3c7; color: #92400e; flex-shrink: 0;
  white-space: nowrap;
}
[data-theme="dark"] .already-selected-badge {
  background: #2d1b00; color: #fcd34d;
}

/* ══════════════════════════════════════════════════
   52. AI RECIPE BUTTON & MODAL
══════════════════════════════════════════════════ */
.ai-recipe-btn {
  width: 100%; padding: 10px 14px;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: #fff; border: none; border-radius: var(--r-lg);
  font-weight: 700; font-size: .82rem; cursor: pointer;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px;
  transition: opacity var(--t);
}
.ai-recipe-btn:hover { opacity: .88; }
.ai-recipe-text { font-size: .88rem; line-height: 1.65; color: var(--text); }
.ai-recipe-text .ai-h2 { font-size: 1.05rem; font-weight: 800; color: var(--primary); margin: 12px 0 6px; }
.ai-recipe-text .ai-h3 { font-size: .95rem; font-weight: 700; color: var(--primary); margin: 10px 0 5px; }
.ai-recipe-text .ai-h4 { font-size: .88rem; font-weight: 700; color: var(--text-2); margin: 8px 0 4px; }
.ai-recipe-text .ai-li  { padding: 3px 0 3px 8px; }
.ai-recipe-text .ai-li-num { padding: 3px 0 3px 8px; }
.ai-loading {
  display: flex; align-items: center; gap: 10px;
  padding: 20px; color: var(--text-3); font-size: .9rem;
}
.ai-spinner {
  width: 18px; height: 18px; border-radius: 50%;
  border: 2.5px solid var(--border);
  border-top-color: var(--primary);
  animation: ai-spin .7s linear infinite; flex-shrink: 0;
}
@keyframes ai-spin { to { transform: rotate(360deg); } }

/* Barra di caricamento AI indeterminata */
.ai-progress-bar {
  height: 100%;
  width: 40%;
  background: linear-gradient(90deg, var(--primary) 0%, color-mix(in srgb, var(--primary) 50%, #fff) 50%, var(--primary) 100%);
  border-radius: 99px;
  animation: ai-progress 1.4s ease-in-out infinite;
}
@keyframes ai-progress {
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(350%); }
}

/* "Powered by Gemini" label — usato dentro pulsanti e header modal */
.ai-powered-label {
  display: block;
  font-size: .65rem; font-weight: 500;
  color: rgba(255,255,255,.75);
  letter-spacing: .03em;
  margin-top: 2px;
  line-height: 1;
}
/* Versione standalone (fuori da pulsanti colorati) */
.section-title + .ai-powered-label,
.modal-title + .ai-powered-label,
div > .ai-powered-label {
  color: var(--text-3);
  font-size: .7rem;
}
/* Pulsante stats: label non blocco ma inline */
#aiStatsBtn .ai-powered-label {
  display: inline;
  font-size: .68rem;
  margin-left: 6px;
  opacity: .8;
}

/* AI substitute suggestions */
.sub-opt-ai {
  background: linear-gradient(135deg,#ede9fe,#ddd6fe) !important;
  color: #5b21b6 !important; border: 1.5px solid #c4b5fd !important;
}
[data-theme="dark"] .sub-opt-ai {
  background: linear-gradient(135deg,#2d1d5e,#1e1640) !important;
  color: #c4b5fd !important; border-color: #6d28d9 !important;
}

/* ══════════════════════════════════════════════════
   53. PA WIZARD INVITE CARD (piano alimentare)
══════════════════════════════════════════════════ */
.pa-wizard-invite {
  display: flex; align-items: center; gap: 16px;
  padding: 20px 22px;
  background: linear-gradient(135deg, var(--primary-xl) 0%, var(--bg-card) 100%);
  border: 2px solid var(--primary-mid);
  border-radius: var(--r-xl); margin-bottom: 20px;
  transition: box-shadow var(--t);
}
.pa-wizard-invite:hover { box-shadow: var(--shadow-lg); }
.pa-wizard-invite-empty {
  border-color: var(--primary); border-style: dashed;
  background: linear-gradient(135deg, var(--primary-light) 0%, var(--bg-card) 100%);
}
.pa-wizard-invite-icon {
  font-size: 2.4rem; flex-shrink: 0;
  line-height: 1;
}
.pa-wizard-invite-body { flex: 1; min-width: 0; }
.pa-wizard-invite-title {
  font-weight: 800; font-size: 1rem; color: var(--text); margin-bottom: 4px;
}
.pa-wizard-invite-sub {
  font-size: .8rem; color: var(--text-3); margin-bottom: 12px; line-height: 1.4;
}
.pa-wizard-invite-btn {
  display: inline-block; padding: 9px 18px;
  background: var(--primary); color: #fff;
  border: none; border-radius: var(--r-full);
  font-weight: 700; font-size: .85rem; cursor: pointer;
  transition: background var(--t);
}
.pa-wizard-invite-btn:hover { background: var(--primary-dark, #2a7a5c); }

@keyframes pa-wizard-pulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(74,155,127,.35); }
  50%      { box-shadow: 0 0 0 12px rgba(74,155,127,0); }
}
.pa-wizard-invite-pulse {
  animation: pa-wizard-pulse 1s ease 2;
}

/* ══════════════════════════════════════════════════
   54. WIZARD — z-index, nuova struttura categorie
══════════════════════════════════════════════════ */
/* FIX CRITICO: wizard sotto ai modali (.modal z-index 500) */
.wizard-overlay {
  position: fixed; inset: 0; z-index: 450;
  background: var(--bg); display: flex; flex-direction: column;
  overflow: hidden;
}

/* Sezioni categoria nel wizard (simile al piano finale) */
.wiz-cat-section {
  border: 1.5px solid var(--border); border-radius: var(--r-lg);
  margin-bottom: 10px; overflow: hidden;
}
.wiz-cat-header {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 14px; cursor: pointer;
  background: var(--bg-card);
  border-left: 3px solid var(--pc, var(--primary));
  user-select: none;
}
.wiz-cat-header:hover { background: var(--bg-hover, var(--bg-subtle)); }
.wiz-cat-icon  { font-size: 1rem; flex-shrink: 0; }
.wiz-cat-label { flex: 1; font-weight: 700; font-size: .88rem; color: var(--text); }
.wiz-cat-count {
  font-size: .72rem; font-weight: 800; padding: 2px 7px;
  border-radius: var(--r-full); background: var(--pc, var(--primary));
  color: #fff;
}
.wiz-cat-chev  { font-size: .75rem; color: var(--text-3); }
.wiz-cat-body  { padding: 8px 12px 10px; background: var(--bg); }

.wiz-ing-row {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 4px; border-bottom: 1px solid var(--border);
}
.wiz-ing-row:last-of-type { border-bottom: none; }
.wiz-ing-name  { flex: 1; font-size: .88rem; font-weight: 500; color: var(--text); }
.wiz-ing-qty   { font-size: .72rem; color: var(--text-3); margin-left: 5px; }
.wiz-ing-del   {
  background: none; border: none; cursor: pointer;
  color: var(--danger); font-size: .8rem; padding: 2px 6px; flex-shrink: 0;
}

.wiz-add-cat-btn {
  display: block; width: 100%; margin-top: 8px;
  padding: 7px 12px; background: none;
  border: 1.5px dashed var(--wc, var(--primary));
  border-radius: var(--r-md); color: var(--wc, var(--primary));
  font-weight: 700; font-size: .82rem; cursor: pointer;
  transition: all var(--t);
}
.wiz-add-cat-btn:hover { background: color-mix(in srgb, var(--wc, var(--primary)) 10%, transparent); }

/* Limiti nel wizard */
.wiz-limit-row {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px; border-bottom: 1px solid var(--border);
}
.wiz-limit-row:last-child { border-bottom: none; }
.wiz-limit-icon  { font-size: 1.1rem; width: 24px; flex-shrink: 0; }
.wiz-limit-label { flex: 1; font-weight: 600; font-size: .9rem; }
.wiz-limit-unit  { font-size: .75rem; color: var(--text-3); }
.wiz-limit-input {
  width: 64px; text-align: center; padding: 5px;
  border: 1.5px solid var(--border); border-radius: var(--r-md);
  background: var(--bg); color: var(--text); font-size: .9rem;
}

/* Revisione */
.wiz-review-intro {
  font-size: .85rem; color: var(--text-3);
  padding: 10px 0 14px; line-height: 1.5;
}
.wiz-review-meal {
  border: 1.5px solid var(--border); border-radius: var(--r-lg);
  margin-bottom: 10px; overflow: hidden;
}
.wiz-review-meal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px; background: var(--bg-card);
  font-weight: 700; font-size: .92rem;
}
.wiz-review-count {
  font-size: .72rem; color: var(--text-3); font-weight: 500;
}
.wiz-review-ings {
  padding: 8px 12px 10px; display: flex; flex-wrap: wrap; gap: 5px;
}
.wiz-review-ing-chip {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 3px 9px; background: var(--bg-subtle);
  border: 1px solid var(--border); border-radius: var(--r-full);
  font-size: .78rem; color: var(--text);
}

/* ══════════════════════════════════════════════════
   PREFERITI — stella sulle card ricetta
══════════════════════════════════════════════════ */
.fav-btn {
  background: none; border: none; cursor: pointer;
  font-size: 1.1rem; line-height: 1; padding: 4px 6px;
  color: var(--text-3); border-radius: var(--r-sm);
  transition: color .15s, transform .15s; flex-shrink: 0;
}
.fav-btn:hover  { color: #f59e0b; transform: scale(1.2); }
.fav-btn.fav-on { color: #f59e0b; }

/* ══════════════════════════════════════════════════
   BADGE DIETA e FILTRI EXTRA
══════════════════════════════════════════════════ */
.badge-diet    { background: #d1fae5; color: #065f46; }
.badge-diet-no { background: #fee2e2; color: #991b1b; }

.rf-pill-extra {
  font-size: .78em; padding: 5px 11px;
  background: var(--bg-subtle); border: 1.5px solid var(--border);
  border-radius: 99px; cursor: pointer; color: var(--text-mid);
  font-weight: 600; transition: all .15s;
}
.rf-pill-extra:hover { border-color: var(--primary-mid); color: var(--primary); }
.rf-pill-extra.active { background: var(--primary); color: #fff; border-color: var(--primary-dark); }

/* ══════════════════════════════════════════════════
   VINCOLI DIETA — toggle nel profilo
══════════════════════════════════════════════════ */
.diet-toggle {
  width: 40px; height: 22px; flex-shrink: 0;
  background: var(--border); border-radius: 99px;
  position: relative; transition: background .2s; cursor: pointer;
}
.diet-toggle-on { background: var(--primary); }
.diet-toggle-knob {
  position: absolute; top: 3px; left: 3px;
  width: 16px; height: 16px; border-radius: 50%;
  background: #fff; transition: left .2s;
  box-shadow: 0 1px 3px rgba(0,0,0,.2);
}
.diet-toggle-on .diet-toggle-knob { left: 21px; }

.allergen-tag {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 3px 9px; background: #fee2e2; color: #991b1b;
  border-radius: 99px; font-size: .78em; font-weight: 600;
}
.allergen-tag button {
  background: none; border: none; cursor: pointer;
  color: #991b1b; font-size: .9em; padding: 0; line-height: 1;
}

/* ══════════════════════════════════════════════════
   SCADENZE DISPENSA
══════════════════════════════════════════════════ */
.expiry-badge {
  display: inline-block; font-size: .7em; font-weight: 700;
  padding: 1px 6px; border-radius: 99px; white-space: nowrap;
}
.expiry-expired { background: #fee2e2; color: #991b1b; }
.expiry-today   { background: #fee2e2; color: #dc2626; }
.expiry-soon    { background: #fef3c7; color: #92400e; }
.expiry-ok      { background: #d1fae5; color: #065f46; }

.expiring-section {
  background: #fffbeb; border: 1.5px solid #fde68a;
  border-radius: var(--r-lg); padding: 12px 14px;
  margin-bottom: 16px;
}
[data-theme="dark"] .expiring-section {
  background: color-mix(in srgb,#92400e 12%,var(--bg-card));
  border-color: #92400e;
}
.expiring-section-title {
  font-size: .8em; font-weight: 800; color: #92400e;
  text-transform: uppercase; letter-spacing: .05em; margin-bottom: 8px;
}
[data-theme="dark"] .expiring-section-title { color: #fbbf24; }
.expiring-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 6px 0; border-bottom: 1px solid #fde68a; cursor: pointer;
}
.expiring-row:last-child { border-bottom: none; }
.expiring-name { font-size: .88em; font-weight: 600; color: var(--text); }
.expiring-recipe-hint {
  font-size: .74em; font-weight: 700; color: var(--primary);
  padding: 2px 7px; background: var(--primary-xl);
  border-radius: 99px; cursor: pointer; white-space: nowrap;
}

/* ── INGREDIENTI IN ESAURIMENTO (deficit-section) ── */
.deficit-section {
  background: #fef3c7;
  border: 1.5px solid #f59e0b;
  border-radius: var(--r-lg);
  padding: 12px 14px;
  margin-bottom: 16px;
}
[data-theme="dark"] .deficit-section {
  background: color-mix(in srgb, #f59e0b 14%, var(--bg-card));
  border-color: #f59e0b;
}
.deficit-section-title {
  font-size: .8em;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: #92400e;
  margin-bottom: 6px;
}
[data-theme="dark"] .deficit-section-title { color: #fbbf24; }
.deficit-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid #fde68a;
  cursor: pointer;
}
.deficit-row:last-child { border-bottom: none; }
.deficit-icon {
  font-size: 1.1em;
  flex-shrink: 0;
}
.deficit-info {
  flex: 1;
  min-width: 0;
}
.deficit-name {
  font-size: .9em;
  font-weight: 600;
  color: var(--text-1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.deficit-label {
  font-size: .76em;
  color: var(--text-3);
  margin-top: 2px;
}
.deficit-row .rc-btn-icon {
  flex-shrink: 0;
}

/* Sottosezione "In esaurimento" dentro ogni categoria dispensa */
.fi-deficit-details {
  margin: 8px 0;
  border: 1px solid rgba(245, 158, 11, 0.4);
  border-radius: var(--r-md);
  background: color-mix(in srgb, #f59e0b 8%, var(--bg-card));
}
[data-theme="dark"] .fi-deficit-details {
  background: color-mix(in srgb, #f59e0b 12%, var(--bg-card));
}
.fi-deficit-summary {
  padding: 6px 10px;
  font-size: .82em;
  font-weight: 700;
  color: #92400e;
  cursor: pointer;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 6px;
}
.fi-deficit-summary::-webkit-details-marker { display: none; }
.fi-deficit-summary::before {
  content: '▶';
  font-size: .7em;
  transition: transform .2s;
}
.fi-deficit-details[open] .fi-deficit-summary::before { transform: rotate(90deg); }
[data-theme="dark"] .fi-deficit-summary { color: #fbbf24; }
.fi-deficit-list {
  padding: 4px 8px 8px;
  border-top: 1px solid rgba(245, 158, 11, 0.25);
}
.fi-deficit-list .deficit-row {
  padding: 6px 4px;
  border-bottom-color: rgba(245, 158, 11, 0.2);
}


/* ── AVVISO INGREDIENTI MANCANTI ── */
.piano-missing-banner {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  background: #fff8e1;
  border: 1.5px solid #f59e0b;
  border-radius: var(--r-lg);
  padding: 12px 14px;
  margin-bottom: 12px;
  font-size: .88rem;
  color: var(--text-1);
}
[data-theme="dark"] .piano-missing-banner {
  background: color-mix(in srgb, #f59e0b 12%, var(--bg-card));
  border-color: #f59e0b;
}
.piano-missing-icon {
  font-size: 1.2em;
  flex-shrink: 0;
  line-height: 1.4;
}
.piano-missing-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}
.piano-missing-chip {
  display: inline-block;
  padding: 2px 10px;
  background: #fef3c7;
  border: 1px solid #f59e0b;
  border-radius: 99px;
  font-size: .8rem;
  font-weight: 600;
  color: #92400e;
  white-space: nowrap;
}
[data-theme="dark"] .piano-missing-chip {
  background: color-mix(in srgb, #f59e0b 20%, var(--bg-card));
  border-color: #f59e0b;
  color: #fbbf24;
}

/* ── Gamification: celebrazione al completamento (Oggi) ── */
.celebration-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  opacity: 0;
  transition: opacity .25s ease;
}
.celebration-overlay.celebration-visible {
  opacity: 1;
}
.celebration-overlay.celebration-out {
  opacity: 0;
  transition: opacity .4s ease;
}
.celebration-icon {
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3.5rem;
  font-weight: 800;
  color: #fff;
  background: var(--primary, #3d8b6f);
  border-radius: 50%;
  box-shadow: 0 8px 32px rgba(61, 139, 111, .5);
  transform: scale(0.3);
  transition: transform .35s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.celebration-visible .celebration-icon {
  transform: scale(1);
}
.celebration-out .celebration-icon {
  transform: scale(1.2);
  opacity: 0;
}
.celebration-recipe .celebration-recipe-icon {
  font-size: 4rem;
  background: linear-gradient(135deg, #3d8b6f 0%, #2d6e55 100%);
  box-shadow: 0 8px 32px rgba(61, 139, 111, .5);
}

/* ── Mobile: pagine meno affollate ── */
@media (max-width: 768px) {
  .page {
    padding: 12px 14px 24px;
    padding-bottom: calc(24px + env(safe-area-inset-bottom));
  }
  .page-header {
    margin-bottom: 14px;
    padding-right: 0;
  }
  .page-header-title { font-size: 1.15rem; }
  .page-header-sub { font-size: .82rem; }
  .app-main .rc-card,
  .app-main .fi-group,
  .app-main .fi-group-collapsible {
    margin-bottom: 12px;
  }
  .rc-card {
    padding: 14px 16px;
  }
  .fi-group-header {
    padding: 14px 16px;
  }
  .fi-list {
    padding: 4px 8px 12px;
  }
  .section-header,
  .ricette-filter-row,
  #ricetteFilterRow {
    margin-bottom: 12px;
  }
  .modal-box {
    margin: 12px;
    max-height: calc(100vh - 24px);
    border-radius: var(--r-xl);
  }
  .modal-header {
    padding: 14px 18px;
  }
  .modal-body {
    padding: 14px 18px;
  }
  .modal-footer {
    padding: 14px 18px;
    gap: 10px;
  }
}
