<!DOCTYPE html>
<html lang="it" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>NutriPlan</title>
    <link id="manifest-placeholder" rel="manifest">
    <link id="appleTouchIcon" rel="apple-touch-icon">
    <meta id="metaThemeColor" name="theme-color" content="#3d8b6f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NutriPlan">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ==================== LANDING ==================== -->
<div id="landingPage">
    <div id="landingLogo"></div>
    <h1 class="landing-title">NutriPlan</h1>
    <p class="landing-sub">Il tuo piano alimentare personale</p>
    <button class="btn btn-primary btn-large" onclick="enterApp()">â–¶ Inizia</button>
</div>

<!-- ==================== MAIN APP ==================== -->
<div id="mainApp">

    <!-- HEADER -->
    <header class="app-header">
        <div class="app-inner">
            <div class="header-left">
                <canvas id="headerIcon" width="32" height="32"></canvas>
                <span class="header-title">NutriPlan</span>
            </div>
            <div class="header-right">
                <span id="cloudStatus" class="cloud-status local">ğŸ’¾ Locale</span>
                <div class="auth-user-pill" id="authUserPill" style="display:none">
                    <img id="authAvatar" class="auth-avatar" src="" alt="" style="display:none">
                    <span id="authInfo" class="auth-info"></span>
                </div>
                <button id="authBtn" class="btn btn-small btn-secondary"
                        style="font-size:.72em;padding:5px 10px;border-radius:8px;"
                        onclick="signInWithGoogle()">Accedi con Google</button>
                <button id="darkToggle" class="btn-icon-only" onclick="toggleDarkMode()">ğŸŒ™</button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="app-main">

        <!-- ===== PIANO ===== -->
        <div id="pianoPage" class="page active">

            <!-- Calendario -->
            <div class="calendar-wrap">
                <div class="calendar-bar-wrap">
                    <div id="calendarBar" class="calendar-bar"></div>
                </div>
                <div id="currentDateLabel" class="current-date-label"></div>
            </div>

            <!-- Tabs Piano -->
            <div class="page-tabs">
                <button class="page-tab active" onclick="showPianoTab('pasto', this)">ğŸ½ Pasto</button>
                <button class="page-tab" onclick="showPianoTab('frigo', this)">â„ï¸ Frigo</button>
                <button class="page-tab" onclick="showPianoTab('ingredienti', this)">ğŸŒ¿ Ingredienti</button>
                <button class="page-tab" onclick="showPianoTab('limiti', this)">ğŸ“Š Limiti</button>
            </div>

            <!-- Tab: Pasto -->
            <div id="pianoTabPasto" class="page-tab-content active">
                <div class="meal-selector" id="mealSelector"></div>
                <div id="mealProgressWrap"></div>
                <div id="mealItemsList" class="meal-items-list"></div>
            </div>

            <!-- Tab: Frigo -->
            <div id="pianoTabFrigo" class="page-tab-content">
                <div class="section-header">
                    <span class="section-title">â„ï¸ Suggerimenti dal frigo</span>
                    <div style="display:flex;gap:6px;align-items:center;">
                        <select id="fridgeSuggestionFilter" class="form-input"
                                style="width:auto;font-size:.8em;padding:6px 10px;"
                                onchange="updateFridgeSuggestions()">
                            <option value="all">Tutti i pasti</option>
                            <option value="colazione">Colazione</option>
                            <option value="pranzo">Pranzo</option>
                            <option value="cena">Cena</option>
                        </select>
                        <button class="btn btn-small btn-secondary" onclick="openSaveFridgeModal()">ğŸ’¾ Salva</button>
                    </div>
                </div>
                <div id="fridgeSuggestions"></div>
                <div style="margin-top:16px;">
                    <div class="section-header">
                        <span class="section-title">ğŸ“ Frigo salvati</span>
                    </div>
                    <div id="savedFridgesList"></div>
                </div>
            </div>

            <!-- Tab: Ingredienti -->
            <div id="pianoTabIngredienti" class="page-tab-content">
                <div class="section-header">
                    <span class="section-title">ğŸŒ¿ Ingredienti del giorno</span>
                </div>
                <div id="dayIngGrid" class="day-ing-grid"></div>
                <div id="dayIngDetails"></div>
            </div>

            <!-- Tab: Limiti -->
            <div id="pianoTabLimiti" class="page-tab-content">
                <div class="section-header">
                    <span class="section-title">ğŸ“Š Limiti settimanali</span>
                    <button class="btn btn-small btn-warning" onclick="resetWeek()">ğŸ”„ Reset</button>
                </div>
                <div id="limitsGrid" class="limits-grid"></div>
            </div>
        </div>

        <!-- ===== DISPENSA ===== -->
        <div id="dispensaPage" class="page">
            <div class="page-tabs">
                <button class="page-tab active" onclick="showDispensaTab('dispensa', this)">ğŸ§º Dispensa</button>
                <button class="page-tab" onclick="showDispensaTab('frigo', this)">â„ï¸ Frigo</button>
            </div>

            <!-- Tab: Dispensa -->
            <div id="dispensaTabDispensa" class="page-tab-content active">
                <div class="search-bar-row">
                    <div class="search-input-wrap">
                        <input type="text" id="pantrySearch" class="form-input search-input"
                               placeholder="ğŸ” Cerca ingrediente..."
                               oninput="filterPantry(this.value)">
                        <button class="search-clear-btn" onclick="clearPantrySearch()">âœ•</button>
                    </div>
                    <button class="btn-add-ing" onclick="openCustomIngModal()">ï¼‹</button>
                </div>
                <div id="pantryContent"></div>
            </div>

            <!-- Tab: Frigo dispensa -->
            <div id="dispensaTabFrigo" class="page-tab-content">
                <div class="section-header">
                    <span class="section-title">â„ï¸ Nel frigo ora</span>
                    <button class="btn btn-small btn-secondary" onclick="openSaveFridgeModal()">ğŸ’¾ Salva frigo</button>
                </div>
                <div id="fridgeContent"></div>
                <div style="margin-top:20px;">
                    <div class="section-header">
                        <span class="section-title">ğŸ“ Frigo salvati</span>
                    </div>
                    <div id="savedFridgesContent"></div>
                </div>
            </div>
        </div>

        <!-- ===== RICETTE ===== -->
        <div id="ricettePage" class="page">
            <div class="page-tabs">
                <button class="page-tab active" onclick="showRicetteTab('catalogo', this)">ğŸ“– Catalogo</button>
                <button class="page-tab" onclick="showRicetteTab('mie', this)">â­ Le mie</button>
            </div>
            <div id="ricetteTabCatalogo" class="page-tab-content active">
                <input type="text" id="ricetteSearch" class="form-input"
                       placeholder="ğŸ” Cerca ricetta o ingrediente..."
                       style="margin-bottom:12px;"
                       oninput="filterRicette(this.value)">
                <div class="ricette-filter-row" id="ricetteFilterRow"></div>
                <div id="ricetteGrid" class="ricette-grid"></div>
            </div>
            <div id="ricetteTabMie" class="page-tab-content">
                <div class="section-header">
                    <span class="section-title">â­ Le mie ricette</span>
                    <button class="btn btn-small btn-primary" onclick="openRicettaForm()">ï¼‹ Nuova</button>
                </div>
                <div id="customRicetteList"></div>
            </div>
        </div>

        <!-- ===== STORICO ===== -->
        <div id="storicoPage" class="page">
            <div class="section-header">
                <span class="section-title">ğŸ“… Storico</span>
            </div>
            <div id="storicoContent"></div>
        </div>

        <!-- ===== SPESA ===== -->
        <div id="spesaPage" class="page">
            <div id="spesaContent"></div>
        </div>

        <!-- ===== STATISTICHE ===== -->
        <div id="statistichePage" class="page">
            <div id="statisticheContent"></div>
        </div>

        <!-- ===== PROFILO ===== -->
        <div id="profiloPage" class="page">
            <div id="profiloContent"></div>
        </div>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <div class="app-inner">
            <button class="nav-tab active" onclick="showPage('piano', this)">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-label">Piano</span>
            </button>
            <button class="nav-tab" onclick="showPage('dispensa', this)">
                <span class="nav-icon">ğŸ§º</span>
                <span class="nav-label">Dispensa</span>
            </button>
            <button class="nav-tab" onclick="showPage('ricette', this)">
                <span class="nav-icon">ğŸ“–</span>
                <span class="nav-label">Ricette</span>
            </button>
            <button class="nav-tab" onclick="showPage('storico', this)">
                <span class="nav-icon">ğŸ“…</span>
                <span class="nav-label">Storico</span>
            </button>
            <button class="nav-tab" onclick="showPage('spesa', this)">
                <span class="nav-icon">ğŸ›’</span>
                <span class="nav-label">Spesa</span>
            </button>
            <button class="nav-tab" onclick="showPage('statistiche', this)">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">Stats</span>
            </button>
            <button class="nav-tab" onclick="showPage('profilo', this)">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-label">Profilo</span>
            </button>
        </div>
    </nav>

    <!-- ==================== MODALS ==================== -->

    <!-- Modal: Dettaglio Ricetta -->
    <div id="recipeModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="recipeModalTitle">Ricetta</h3>
                <button class="modal-close" onclick="closeRecipeModal()">âœ•</button>
            </div>
            <div class="modal-body" id="recipeModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRecipeModal()">Chiudi</button>
                <button class="btn btn-primary" id="applyRecipeBtn" onclick="applyRecipeToMeal()">
                    âœ… Applica al piano
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Salva Frigo -->
    <div id="saveFridgeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’¾ Salva configurazione frigo</h3>
                <button class="modal-close" onclick="closeSaveFridgeModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nome configurazione</label>
                    <input type="text" id="fridgeName" class="form-input"
                           placeholder="es. Spesa settimanale, Dopo vacanze...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSaveFridgeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="saveFridge()">ğŸ’¾ Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal: Ingrediente Custom â€” CON CATEGORIA -->
    <div id="customIngModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â• Aggiungi ingrediente</h3>
                <button class="modal-close" onclick="closeCustomIngModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nome ingrediente</label>
                    <input type="text" id="customIngName" class="form-input"
                           placeholder="es. Tofu, Avena, Lenticchie rosse...">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="customIngCategory" class="form-input">
                        <option value="ğŸ¥© Carne e Pesce">ğŸ¥© Carne e Pesce</option>
                        <option value="ğŸ¥› Latticini e Uova">ğŸ¥› Latticini e Uova</option>
                        <option value="ğŸŒ¾ Cereali e Legumi">ğŸŒ¾ Cereali e Legumi</option>
                        <option value="ğŸ¥¦ Verdure">ğŸ¥¦ Verdure</option>
                        <option value="ğŸ Frutta">ğŸ Frutta</option>
                        <option value="ğŸ¥‘ Grassi e Condimenti">ğŸ¥‘ Grassi e Condimenti</option>
                        <option value="ğŸ« Dolci e Snack">ğŸ« Dolci e Snack</option>
                        <option value="ğŸ§‚ Cucina">ğŸ§‚ Cucina</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>UnitÃ  di misura</label>
                    <select id="customIngUnit" class="form-input">
                        <option value="g">g</option>
                        <option value="ml">ml</option>
                        <option value="pz">pz</option>
                        <option value="fette">fette</option>
                        <option value="cucchiai">cucchiai</option>
                        <option value="cucchiaini">cucchiaini</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCustomIngModal()">Annulla</button>
                <button class="btn btn-primary" onclick="addCustomIngredient()">â• Aggiungi</button>
            </div>
        </div>
    </div>

    <!-- Modal: Form Ricetta Custom -->
    <div id="ricettaFormModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="ricettaFormTitle">â­ Nuova ricetta</h3>
                <button class="modal-close" onclick="closeRicettaForm()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nome ricetta</label>
                    <input type="text" id="rfNome" class="form-input" placeholder="es. Pasta al pesto...">
                </div>
                <div class="form-group">
                    <label>Pasto ideale</label>
                    <select id="rfPasto" class="form-input">
                        <option value="colazione">â˜• Colazione</option>
                        <option value="spuntino">ğŸ Spuntino</option>
                        <option value="pranzo">ğŸ½ï¸ Pranzo</option>
                        <option value="merenda">ğŸ¥ª Merenda</option>
                        <option value="cena">ğŸŒ™ Cena</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ingredienti</label>
                    <div id="rfIngredientiList"></div>
                    <button class="btn btn-secondary btn-small" style="margin-top:6px;"
                            onclick="addRfIngrediente()">ï¼‹ Ingrediente</button>
                </div>
                <div class="form-group">
                    <label>Preparazione</label>
                    <textarea id="rfPreparazione" class="form-input form-textarea"
                              placeholder="Descrivi i passi di preparazione..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRicettaForm()">Annulla</button>
                <button class="btn btn-primary" onclick="saveRicettaCustom()">ğŸ’¾ Salva ricetta</button>
            </div>
        </div>
    </div>

    <!-- Modal: Spesa Item -->
    <div id="spesaItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ›’ Dettaglio articolo</h3>
                <button class="modal-close" onclick="closeSpesaItemModal()">âœ•</button>
            </div>
            <div class="modal-body" id="spesaItemModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSpesaItemModal()">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- ==================== BANNERS ==================== -->
    <div id="iosBanner" class="ios-banner">
        <div class="ios-banner-content">
            <span>ğŸ“² Installa NutriPlan: tocca <b>Condividi</b> poi <b>Aggiungi a Home</b></span>
            <button onclick="closeIosBanner()" style="background:none;border:none;cursor:pointer;font-size:1.1em;color:var(--text-light);">âœ•</button>
        </div>
    </div>
    <div id="installBanner" class="install-banner">
        <div class="install-banner-content">
            <span>ğŸ“² Installa NutriPlan come app</span>
            <button id="installBtn" class="btn btn-primary btn-small">Installa</button>
            <button id="dismissBtn" class="btn btn-secondary btn-small">âœ•</button>
        </div>
    </div>

</div><!-- fine #mainApp -->

<!-- ==================== SCRIPTS ==================== -->
<script src="firebase-config.js"></script>
<script src="data.js"></script>
<script src="storage.js"></script>
<script src="app.js"></script>
<script src="piano.js"></script>
<script src="dispensa.js"></script>
<script src="ricette.js"></script>
<script src="ricette_custom.js"></script>
<script src="storico.js"></script>
<script src="spesa.js"></script>
<script src="statistiche.js"></script>
<script src="pdf.js"></script>
<script src="profilo.js"></script>

</body>
</html>
