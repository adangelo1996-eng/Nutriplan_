<!DOCTYPE html>
<html lang="it" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="NutriPlan" />
  <meta id="metaThemeColor" name="theme-color" content="#1c4434" />
  <title>NutriPlan</title>
  <link id="manifest-placeholder" rel="manifest" href="data:application/json,{}" />
  <link id="appleTouchIcon" rel="apple-touch-icon" href="" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap"
        rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="landingPage">
  <div id="landingLogo">ğŸŒ¿</div>
  <h1 class="landing-title">NutriPlan</h1>
  <p class="landing-sub">Il tuo piano alimentare personale</p>
  <button class="btn btn-primary btn-large" onclick="startApp()">â–¶ Inizia</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appShell" style="display:none;">

  <!-- â•â•â• HEADER â•â•â• -->
  <header class="app-header">
    <div class="app-inner">

      <!-- Sinistra: logo + titolo -->
      <div class="header-left">
        <canvas id="headerIcon" width="32" height="32"
                style="border-radius:8px;flex-shrink:0;"></canvas>
        <span class="header-title">NutriPlan</span>
      </div>

      <!-- Centro: cloud status -->
      <div class="header-center">
        <div id="cloudStatus" class="cloud-status local">
          <span>â˜ Locale</span>
        </div>
      </div>

      <!-- Destra: tema + auth -->
      <div class="header-right">
        <button class="btn-icon-only"
                data-theme-toggle
                onclick="toggleTheme()"
                title="Cambia tema"
                aria-label="Cambia tema">ğŸŒ™</button>

        <!-- Pill utente loggato -->
        <div id="authUserPill" class="auth-user-pill"
             onclick="openAuthModal()" style="display:none;">
          <img id="authAvatar" class="auth-avatar" src="" alt="Avatar"
               onerror="this.style.display='none'" />
          <span id="authUserName" class="auth-info">Utente</span>
        </div>

        <!-- Bottone login (se non loggato) -->
        <button id="authLoginBtn" class="btn-icon-only"
                onclick="openAuthModal()"
                title="Accedi" aria-label="Accedi">ğŸ‘¤</button>
      </div>

    </div>
  </header>

  <!-- â•â•â• SIDEBAR desktop â•â•â• -->
  <nav class="sidebar-nav" id="sidebarNav">
    <div class="sidebar-section-label">Piano</div>
    <button class="nav-tab active" data-page="piano"   onclick="switchPage('piano')">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">Piano</span>
    </button>
    <button class="nav-tab" data-page="pantry"  onclick="switchPage('pantry')">
      <span class="nav-icon">â„ï¸</span>
      <span class="nav-label">Frigo</span>
    </button>
    <button class="nav-tab" data-page="ricette" onclick="switchPage('ricette')">
      <span class="nav-icon">ğŸ“–</span>
      <span class="nav-label">Ricette</span>
    </button>
    <div class="sidebar-section-label">Gestione</div>
    <button class="nav-tab" data-page="storico" onclick="switchPage('storico')">
      <span class="nav-icon">ğŸ“…</span>
      <span class="nav-label">Storico</span>
    </button>
    <button class="nav-tab" data-page="spesa"   onclick="switchPage('spesa')">
      <span class="nav-icon">ğŸ›’</span>
      <span class="nav-label">Spesa</span>
    </button>
    <button class="nav-tab" data-page="stats"   onclick="switchPage('stats')">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-label">Stats</span>
    </button>
    <button class="nav-tab" data-page="profilo" onclick="switchPage('profilo')">
      <span class="nav-icon">ğŸ‘¤</span>
      <span class="nav-label">Profilo</span>
    </button>
  </nav>

  <!-- â•â•â• MAIN CONTENT â•â•â• -->
  <main class="app-main">

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: PIANO
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="pianoPasto" class="page active">

      <div class="page-header">
        <div>
          <div class="page-header-title">Il tuo piano ğŸ½</div>
          <div class="page-header-sub" id="currentDateLabel">Oggi</div>
        </div>
        <div class="page-header-actions">
          <button class="btn btn-secondary btn-small" onclick="resetDay()">ğŸ”„ Reset</button>
        </div>
      </div>

      <!-- Tab interni piano -->
      <div class="page-tabs" id="pianoTabs">
        <button class="page-tab active" data-tab="pasto"
                onclick="switchPianoTab('pasto')">ğŸ½ Pasto</button>
        <button class="page-tab" data-tab="frigo-piano"
                onclick="switchPianoTab('frigo-piano')">â„ï¸ Frigo</button>
        <button class="page-tab" data-tab="ingredienti"
                onclick="switchPianoTab('ingredienti')">ğŸŒ¿ Ingredienti</button>
        <button class="page-tab" data-tab="limiti"
                onclick="switchPianoTab('limiti')">ğŸ“Š Limiti</button>
      </div>

      <!-- â”€â”€ TAB: Pasto â”€â”€ -->
      <div class="page-tab-content active" id="tab-pasto">

        <!-- Calendario -->
        <div class="calendar-wrap">
          <div class="calendar-bar-wrap">
            <div class="calendar-bar" id="calendarBar"></div>
          </div>
          <div class="current-date-label" id="selectedDateLabel"></div>
        </div>

        <!-- Riepilogo pasti completati -->
        <div class="card" style="margin-bottom:16px;padding:12px 16px;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <span style="font-size:.84rem;font-weight:700;">Pasti completati oggi</span>
            <span class="pill pill-primary" id="mealSummaryCount">0 / 5</span>
          </div>
        </div>

        <!-- Selettore pasto â€” scrollabile -->
        <div class="meal-selector" id="mealSelector">
          <button class="meal-btn active" data-meal="colazione"
                  onclick="selectMeal('colazione')">
            <span class="meal-btn-icon">â˜€ï¸</span>
            <span class="meal-btn-label">Colazione</span>
            <span class="meal-btn-count" id="cnt-colazione">0</span>
          </button>
          <button class="meal-btn" data-meal="spuntino"
                  onclick="selectMeal('spuntino')">
            <span class="meal-btn-icon">ğŸ</span>
            <span class="meal-btn-label">Spuntino</span>
            <span class="meal-btn-count" id="cnt-spuntino">0</span>
          </button>
          <button class="meal-btn" data-meal="pranzo"
                  onclick="selectMeal('pranzo')">
            <span class="meal-btn-icon">ğŸ½</span>
            <span class="meal-btn-label">Pranzo</span>
            <span class="meal-btn-count" id="cnt-pranzo">0</span>
          </button>
          <button class="meal-btn" data-meal="merenda"
                  onclick="selectMeal('merenda')">
            <span class="meal-btn-icon">ğŸ¥ª</span>
            <span class="meal-btn-label">Merenda</span>
            <span class="meal-btn-count" id="cnt-merenda">0</span>
          </button>
          <button class="meal-btn" data-meal="cena"
                  onclick="selectMeal('cena')">
            <span class="meal-btn-icon">ğŸŒ™</span>
            <span class="meal-btn-label">Cena</span>
            <span class="meal-btn-count" id="cnt-cena">0</span>
          </button>
        </div>

        <!-- Contenuto pasto -->
        <div id="mealContent"></div>

      </div><!-- /tab-pasto -->

      <!-- â”€â”€ TAB: Frigo nel piano â”€â”€ -->
      <div class="page-tab-content" id="tab-frigo-piano">
        <div class="section-header">
          <div>
            <div class="section-title">â„ï¸ Ricette con quel che hai</div>
            <div class="section-subtitle">In base agli ingredienti nel frigo</div>
          </div>
        </div>
        <div id="fridgeRecipesContent"></div>
      </div>

      <!-- â”€â”€ TAB: Ingredienti â”€â”€ -->
      <div class="page-tab-content" id="tab-ingredienti">
        <div class="section-header">
          <div>
            <div class="section-title">ğŸŒ¿ Ingredienti del giorno</div>
            <div class="section-subtitle">Tutti gli ingredienti nel piano odierno</div>
          </div>
          <div style="display:flex;gap:8px;flex-shrink:0;">
            <button class="btn btn-secondary btn-small"
                    onclick="saveFridgeConfig()">ğŸ’¾ Salva</button>
            <button class="btn btn-secondary btn-small"
                    onclick="openSavedFridgeModal()">ğŸ“ Frigo salvati</button>
          </div>
        </div>
        <div id="ingredientiContent"></div>
      </div>

      <!-- â”€â”€ TAB: Limiti â”€â”€ -->
      <div class="page-tab-content" id="tab-limiti">
        <div class="section-header">
          <div>
            <div class="section-title">ğŸ“Š Limiti settimanali</div>
            <div class="section-subtitle">Monitoraggio consumi</div>
          </div>
        </div>
        <div id="limitiContent"></div>
      </div>

    </section><!-- /pianoPasto -->

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: FRIGO
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="pantryPage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">â„ï¸ Frigo</div>
          <div class="page-header-sub">Ingredienti disponibili</div>
        </div>
        <div class="page-header-actions">
          <button class="btn btn-secondary btn-small"
                  onclick="openSavedFridgeModal()">ğŸ“ Salvati</button>
          <button class="btn btn-primary btn-small"
                  onclick="openAddFridgeModal()">â• Aggiungi</button>
        </div>
      </div>

      <!-- Ricerca -->
      <div class="search-bar-row">
        <div class="search-input-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="search" id="pantrySearch"
                 placeholder="Cerca ingrediente o categoriaâ€¦"
                 oninput="filterPantry(this.value)"
                 onsearch="filterPantry(this.value)" />
          <button class="search-clear-btn"
                  onclick="clearPantrySearch()"
                  aria-label="Cancella ricerca">âœ•</button>
        </div>
      </div>

      <!-- Lista frigo â€” popolata da dispensa.js -->
      <div id="pantryContent"></div>

    </section><!-- /pantryPage -->

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: RICETTE
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="ricettePage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">ğŸ“– Ricette</div>
          <div class="page-header-sub">Catalogo e ricette personali</div>
        </div>
      </div>

      <div class="page-tabs" id="ricetteTabs">
        <button class="page-tab active" data-tab="catalogo"
                onclick="switchRicetteTab('catalogo')">ğŸ“– Catalogo</button>
        <button class="page-tab" data-tab="mie"
                onclick="switchRicetteTab('mie')">â­ Le mie</button>
      </div>

      <!-- Tab: Catalogo -->
      <div class="page-tab-content active" id="tab-catalogo">
        <div class="ricette-filter-row" id="ricetteFilterRow"></div>
        <div id="ricetteContent"></div>
      </div>

      <!-- Tab: Le mie ricette -->
      <div class="page-tab-content" id="tab-mie">
        <div class="section-header">
          <div class="section-title">â­ Le mie ricette</div>
          <button class="btn btn-primary btn-small"
                  onclick="openNewRicettaModal()">ï¼‹ Nuova</button>
        </div>
        <div id="customRicetteContent"></div>
      </div>

    </section><!-- /ricettePage -->

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: STORICO
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="storicoPage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">ğŸ“… Storico pasti</div>
          <div class="page-header-sub">Cronologia alimentare</div>
        </div>
      </div>
      <div id="storicoContent"></div>

    </section>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: SPESA
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="spesaPage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">ğŸ›’ Lista spesa</div>
          <div class="page-header-sub">Cosa comprare</div>
        </div>
        <div class="page-header-actions">
          <button class="btn btn-secondary btn-small"
                  onclick="clearCompletedSpesa ? clearCompletedSpesa() : null">ğŸ—‘ Pulisci</button>
          <button class="btn btn-primary btn-small"
                  onclick="openAddSpesaModal ? openAddSpesaModal() : null">â• Aggiungi</button>
        </div>
      </div>
      <div id="spesaContent"></div>

    </section>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: STATS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="statsPage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">ğŸ“Š Statistiche</div>
          <div class="page-header-sub">Riepilogo settimanale</div>
        </div>
      </div>
      <div id="statsContent"></div>

    </section>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         PAGINA: PROFILO
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="profiloPage" class="page">

      <div class="page-header">
        <div>
          <div class="page-header-title">ğŸ‘¤ Profilo</div>
          <div class="page-header-sub">Impostazioni e piano personale</div>
        </div>
      </div>
      <div id="profiloContent"></div>

    </section>

  </main><!-- /app-main -->

  <!-- â•â•â• BOTTOM NAV mobile â•â•â• -->
  <nav class="bottom-nav" id="bottomNav">
    <div class="app-inner">
      <button class="nav-tab active" data-page="piano"
              onclick="switchPage('piano')">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-label">Piano</span>
      </button>
      <button class="nav-tab" data-page="pantry"
              onclick="switchPage('pantry')">
        <span class="nav-icon">â„ï¸</span>
        <span class="nav-label">Frigo</span>
      </button>
      <button class="nav-tab" data-page="ricette"
              onclick="switchPage('ricette')">
        <span class="nav-icon">ğŸ“–</span>
        <span class="nav-label">Ricette</span>
      </button>
      <button class="nav-tab" data-page="storico"
              onclick="switchPage('storico')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-label">Storico</span>
      </button>
      <button class="nav-tab" data-page="spesa"
              onclick="switchPage('spesa')">
        <span class="nav-icon">ğŸ›’</span>
        <span class="nav-label">Spesa</span>
      </button>
      <button class="nav-tab" data-page="stats"
              onclick="switchPage('stats')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Stats</span>
      </button>
      <button class="nav-tab" data-page="profilo"
              onclick="switchPage('profilo')">
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-label">Profilo</span>
      </button>
    </div>
  </nav>

</div><!-- /appShell -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- â”€â”€ Dettaglio ricetta â”€â”€ -->
<div class="modal" id="recipeModal">
  <div class="modal-content modal-content-large">
    <div class="modal-header">
      <h3>Ricetta</h3>
      <button class="modal-close" onclick="closeRecipeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="recipeModalBody"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeRecipeModal()">Chiudi</button>
      <button class="btn btn-primary"   onclick="addRecipeToPlan && addRecipeToPlan()">
        âœ… Aggiungi al piano
      </button>
    </div>
  </div>
</div>

<!-- â”€â”€ Salva configurazione frigo â”€â”€ -->
<div class="modal" id="saveFridgeModal">
  <div class="modal-content modal-content-small">
    <div class="modal-header">
      <h3>ğŸ’¾ Salva frigo</h3>
      <button class="modal-close" onclick="closeSaveFridgeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nome configurazione</label>
        <input type="text" id="fridgeConfigName"
               placeholder="Es. Frigo lunedÃ¬â€¦"
               onkeydown="if(event.key==='Enter') confirmSaveFridge()" />
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button class="btn btn-secondary" style="flex:1;"
                onclick="closeSaveFridgeModal()">Annulla</button>
        <button class="btn btn-primary"   style="flex:1;"
                onclick="confirmSaveFridge()">ğŸ’¾ Salva</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Frigo salvati â”€â”€ -->
<div class="modal" id="savedFridgeModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ“ Configurazioni salvate</h3>
      <button class="modal-close" onclick="closeSavedFridgeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="savedFridgeList">
      <div class="rc-empty"><p>Nessuna configurazione salvata.</p></div>
    </div>
  </div>
</div>

<!-- â”€â”€ Aggiungi ingrediente al frigo â”€â”€ -->
<div class="modal" id="addFridgeModal">
  <div class="modal-content modal-content-small">
    <div class="modal-header">
      <h3>â• Aggiungi al frigo</h3>
      <button class="modal-close" onclick="closeAddFridgeModal()">âœ•</button>
    </div>
    <div class="modal-body">

      <div class="form-group">
        <label>Ingrediente</label>
        <input type="text" id="newFridgeItem"
               placeholder="Es. Pollo, Latteâ€¦"
               list="ingredientiAutocomplete"
               autocomplete="off"
               onkeydown="if(event.key==='Enter') confirmAddFridge()" />
        <datalist id="ingredientiAutocomplete"></datalist>
      </div>

      <div class="form-group">
        <label>Categoria</label>
        <select id="newFridgeCategory">
          <option value="">-- Seleziona categoria --</option>
          <option value="ğŸ¥© Carne e Pesce">ğŸ¥© Carne e Pesce</option>
          <option value="ğŸ¥› Latticini e Uova">ğŸ¥› Latticini e Uova</option>
          <option value="ğŸŒ¾ Cereali e Legumi">ğŸŒ¾ Cereali e Legumi</option>
          <option value="ğŸ¥¦ Verdure">ğŸ¥¦ Verdure</option>
          <option value="ğŸ Frutta">ğŸ Frutta</option>
          <option value="ğŸ¥‘ Grassi e Condimenti">ğŸ¥‘ Grassi e Condimenti</option>
          <option value="ğŸ« Dolci e Snack">ğŸ« Dolci e Snack</option>
          <option value="ğŸ§‚ Cucina">ğŸ§‚ Cucina</option>
        </select>
      </div>

      <div style="display:flex;gap:8px;align-items:flex-end;">
        <div class="form-group" style="flex:1;margin-bottom:0;">
          <label>QuantitÃ </label>
          <input type="number" id="newFridgeQty"
                 min="0" step="any" placeholder="0"
                 onkeydown="if(event.key==='Enter') confirmAddFridge()" />
        </div>
        <div class="form-group" style="width:96px;margin-bottom:0;">
          <label>UnitÃ </label>
          <select id="newFridgeUnit">
            <option value="g">g</option>
            <option value="ml">ml</option>
            <option value="pz">pz</option>
            <option value="fette">fette</option>
            <option value="cucchiai">cucchiai</option>
            <option value="cucchiaini">cucchiaini</option>
            <option value="porzione">porzione</option>
            <option value="kg">kg</option>
            <option value="l">l</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:20px;">
        <button class="btn btn-secondary" style="flex:1;"
                onclick="closeAddFridgeModal()">Annulla</button>
        <button class="btn btn-primary"   style="flex:1;"
                onclick="confirmAddFridge()">â• Aggiungi</button>
      </div>

    </div>
  </div>
</div>

<!-- â”€â”€ Modifica quantitÃ  frigo (click su riga ingrediente) â”€â”€ -->
<div class="modal" id="editQtyModal">
  <div class="modal-content modal-content-small">
    <div class="modal-header">
      <div style="display:flex;align-items:center;gap:10px;min-width:0;">
        <span id="eqmIcon" style="font-size:1.6rem;flex-shrink:0;"></span>
        <h3 id="eqmName"
            style="font-size:.94rem;font-weight:800;
                   white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></h3>
      </div>
      <button class="modal-close" onclick="closeQtyModal()">âœ•</button>
    </div>
    <div class="modal-body" style="padding:20px;">
      <p style="font-size:.8rem;color:var(--text-light);margin-bottom:16px;">
        Inserisci la quantitÃ  manualmente
      </p>
      <div style="display:flex;align-items:center;gap:10px;">
        <input type="number" id="eqmInput"
               min="0" step="any" placeholder="0"
               style="flex:1;font-size:1.3rem;font-weight:800;text-align:center;"
               onkeydown="if(event.key==='Enter') confirmQtyModal();
                          if(event.key==='Escape') closeQtyModal();" />
        <span id="eqmUnit"
              style="font-size:.88rem;font-weight:700;
                     color:var(--text-light);
                     background:var(--bg-subtle);
                     border:1.5px solid var(--border);
                     border-radius:var(--r);
                     padding:10px 14px;
                     white-space:nowrap;flex-shrink:0;">g</span>
      </div>
      <div style="display:flex;gap:8px;margin-top:20px;">
        <button class="btn btn-secondary" style="flex:1;"
                onclick="closeQtyModal()">Annulla</button>
        <button class="btn btn-primary"   style="flex:1;"
                onclick="confirmQtyModal()">âœ… Conferma</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Nuova ricetta custom â”€â”€ -->
<div class="modal" id="newRicettaModal">
  <div class="modal-content modal-content-large">
    <div class="modal-header">
      <h3>â­ Nuova ricetta</h3>
      <button class="modal-close" onclick="closeNewRicettaModal()">âœ•</button>
    </div>
    <div class="modal-body">

      <div class="form-group">
        <label>Nome</label>
        <input type="text" id="newRicettaNome"
               placeholder="Es. Pasta al pomodoroâ€¦" />
      </div>

      <div class="form-group">
        <label>Pasto ideale</label>
        <select id="newRicettaPasto">
          <option value="colazione">â˜€ï¸ Colazione</option>
          <option value="spuntino">ğŸ Spuntino</option>
          <option value="pranzo" selected>ğŸ½ Pranzo</option>
          <option value="merenda">ğŸ¥ª Merenda</option>
          <option value="cena">ğŸŒ™ Cena</option>
        </select>
      </div>

      <div class="form-group">
        <label>Ingredienti</label>
        <div id="newRicettaIngList" class="ing-preview-list"></div>
        <div class="add-ing-row" style="margin-top:8px;">
          <input type="text"   id="newIngName"
                 placeholder="Ingrediente"
                 list="ingredientiAutocomplete"
                 autocomplete="off"
                 style="flex:2;" />
          <input type="number" id="newIngQty"
                 placeholder="QtÃ " min="0" step="any"
                 style="flex:1;" />
          <select id="newIngUnit" style="flex:1;">
            <option value="g">g</option>
            <option value="ml">ml</option>
            <option value="pz">pz</option>
            <option value="fette">fette</option>
            <option value="cucchiai">cucchiai</option>
            <option value="cucchiaini">cucchiaini</option>
            <option value="porzione">porzione</option>
            <option value="kg">kg</option>
            <option value="l">l</option>
          </select>
          <button class="btn-add-ing"
                  onclick="addIngToNewRicetta && addIngToNewRicetta()">ï¼‹</button>
        </div>
      </div>

      <div class="form-group">
        <label>Preparazione</label>
        <textarea id="newRicettaPrep"
                  placeholder="Descrivi i passaggiâ€¦" rows="4"></textarea>
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary"
              onclick="closeNewRicettaModal()">Annulla</button>
      <button class="btn btn-primary"
              onclick="saveNewRicetta && saveNewRicetta()">ğŸ’¾ Salva ricetta</button>
    </div>
  </div>
</div>

<!-- â”€â”€ QuantitÃ  acquistata (spesa â†’ frigo) â”€â”€ -->
<div class="modal" id="purchasedQtyModal">
  <div class="modal-content modal-content-small">
    <div class="modal-header">
      <h3>âœ… QuantitÃ  acquistata</h3>
      <button class="modal-close" onclick="closePurchasedQtyModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p style="font-size:.82rem;color:var(--text-light);margin-bottom:16px;">
        Inserisci la quantitÃ  acquistata per aggiornare il frigo automaticamente.
      </p>
      <div style="display:flex;gap:8px;align-items:center;">
        <input type="number" id="purchasedQtyInput"
               min="0" step="any" placeholder="0"
               style="flex:1;"
               onkeydown="if(event.key==='Enter') confirmPurchasedQty && confirmPurchasedQty()" />
        <select id="purchasedQtyUnit" style="width:100px;">
          <option value="g">g</option>
          <option value="ml">ml</option>
          <option value="pz">pz</option>
          <option value="fette">fette</option>
          <option value="cucchiai">cucchiai</option>
          <option value="cucchiaini">cucchiaini</option>
          <option value="porzione">porzione</option>
          <option value="kg">kg</option>
          <option value="l">l</option>
        </select>
      </div>
      <div style="display:flex;gap:8px;margin-top:20px;">
        <button class="btn btn-secondary" style="flex:1;"
                onclick="skipPurchasedQty && skipPurchasedQty()">Salta</button>
        <button class="btn btn-primary"   style="flex:1;"
                onclick="confirmPurchasedQty && confirmPurchasedQty()">âœ… Conferma</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Auth (login / profilo) â”€â”€ -->
<div class="modal" id="authModal">
  <div class="modal-content modal-content-small">
    <div class="modal-header">
      <h3 id="authModalTitle">Accedi</h3>
      <button class="modal-close" onclick="closeAuthModal()">âœ•</button>
    </div>
    <div class="modal-body" id="authModalBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BANNER iOS / PWA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- iOS Safari -->
<div class="ios-banner" id="iosBanner">
  <div class="ios-banner-icon">ğŸ“²</div>
  <div class="ios-banner-text">
    <strong>Installa NutriPlan come app</strong>
    Tocca <strong>â¬†ï¸ Condividi</strong> poi
    <strong>"Aggiungi a schermata Home"</strong>
  </div>
  <button class="ios-banner-close"
          onclick="dismissIosBanner()"
          aria-label="Chiudi">âœ•</button>
</div>

<!-- Android / Chrome -->
<div id="installPwaBanner"
     style="display:none;position:fixed;
            bottom:calc(var(--nav-h) + env(safe-area-inset-bottom) + 12px);
            left:14px;right:14px;z-index:400;
            background:var(--bg-card);border-radius:var(--r-xl);
            padding:14px 16px;box-shadow:var(--shadow-lg);
            border:1.5px solid var(--border);
            align-items:center;gap:12px;">
  <span style="font-size:1.6rem;flex-shrink:0;">ğŸ“²</span>
  <span style="flex:1;font-size:.82rem;color:var(--text-mid);">
    <strong style="display:block;color:var(--text);margin-bottom:2px;">
      Installa NutriPlan come app
    </strong>
  </span>
  <button class="btn btn-primary btn-small"
          onclick="installPwa()">Installa</button>
  <button class="btn-icon-only"
          onclick="dismissInstallBanner()"
          style="flex-shrink:0;" aria-label="Chiudi">âœ•</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SYNC BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="sync-banner" id="syncBanner"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST CONTAINER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast-container" id="toastContainer"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPTS â€” ordine importante
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="firebase-config.js"></script>
<script src="data.js"></script>
<script src="storage.js"></script>
<script src="dispensa.js"></script>
<script src="piano.js"></script>
<script src="ricette.js"></script>
<script src="ricette_custom.js"></script>
<script src="storico.js"></script>
<script src="spesa.js"></script>
<script src="statistiche.js"></script>
<script src="profilo.js"></script>
<script src="pdf.js"></script>
<script src="app.js"></script>

</body>
</html>
